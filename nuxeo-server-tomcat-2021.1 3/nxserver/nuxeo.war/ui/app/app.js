import"./vendor/jquery.handsontable.full.js";import"./lib/handsontable.patches.js";import"./vendor/jquery.handsontable.full.css";import"select2/select2.js";import"select2/select2.css";import"./styles/styles.css";import"nuxeo/nuxeo.js";import{parseParams,b64DecodeUnicode}from"./utils";import{Log}from"./ui/log";import{Spreadsheet}from"./ui/spreadsheet";import{i18n}from"./ui/i18n";let sheet,log;function setupUI(){log=new Log($("#console")),$("#close").click((()=>{window.parent.jQuery&&window.parent.jQuery.fancybox&&window.parent.jQuery.fancybox.close()})),$("#close").toggle(!0),$("#save").click((()=>{log.info(i18n("saving")),sheet.save().then((e=>{if(!e)return void log.error(i18n("failedSave"));let t;t=0===e.length?i18n("upToDate"):`${e.length} ${i18n("rowsSaved")}`,log.info(t)}))})),$("input[name=autosave]").click((function(){sheet.autosave=$(this).is(":checked"),sheet.autosave?log.default(i18n("autoSave")):log.default("")})),$(document).ajaxStart((()=>$("#loading").show())),$(document).ajaxStop((()=>$("#loading").hide()))}function doQuery(){return sheet.update().catch((e=>log.error(e.message)))}const getParameters=()=>new Promise((e=>{if(window.location.search){const t=parseParams();e(JSON.parse(b64DecodeUnicode(t.cv)))}else window.addEventListener("message",(({data:t})=>e(t)))}));function run({baseURL:e="/nuxeo",resultColumns:t,pageProviderName:o,queryParameters:s,searchDocument:n,sortInfos:a}){const r=new Nuxeo({baseURL:e});return r.schemas(["*"]),setupUI(),r.connect().then((()=>{const e=navigator.language&&navigator.language.slice(0,2)||"en";if(t&&0!==t.length||(t=[{label:"Title",field:"dc:title"},{label:"Modified",field:"dc:modified"},{label:"Last Contributor",field:"dc:lastContributor"},{label:"State",field:"currentLifeCycleState"}]),window.spreadsheet=sheet=new Spreadsheet($("#grid"),r,t,o,e),s&&(sheet.queryParameters=s),n){const e={};for(const t in n.properties){const o=n.properties[t];void 0!==o.length&&0===o.length||(e[t]="string"==typeof o?o:JSON.stringify(o))}sheet.namedParameters=e}return a&&a.length>0&&(sheet.sortInfos=a),doQuery()}))}new Promise((e=>{if(window.location.search){const t=parseParams();e(JSON.parse(b64DecodeUnicode(t.cv)))}else window.addEventListener("message",(({data:t})=>e(t)))})).then(run);