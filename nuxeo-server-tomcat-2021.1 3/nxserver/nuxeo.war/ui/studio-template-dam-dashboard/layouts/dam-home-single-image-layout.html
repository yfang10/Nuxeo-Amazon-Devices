<!--
`dam-home-single-image-layout`
@group Nuxeo UI
@element dam-home-single-image-layout
-->
<dom-module id="dam-home-single-image-layout">
  <template>
    <style include="nuxeo-styles nuxeo-dam-page-style iron-flex iron-flex-alignment">

      .highlight {
        width:100%;
        height:70vh;
      }

      .left {
        width:66.66%;
        height:100%;
        position: relative;
      }

      .right {
        width:33.33%;
        height:100%;
      }

      img {
        width:100%;
        height:100%;
        object-fit: cover;
      }

      .left .item {
        position: relative;
      }

      .left .overlay {
        position: absolute;
        top: 0px;
        width:100%;
        height:100%;
        background: linear-gradient(to left, rgba(0,0,0,0) 0%,rgba(0,0,0,0.3) 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
        z-index:2;
      }

      .left .titlebox {
        max-width: 40%;
        position: absolute;
        justify-content: center;
        top:0;
        bottom: 0;
        left: 10%;
        right: 0;
        z-index:3;
        color: white;
      }

      .left .title {
        font-weight: 100;
        line-height: 5rem;
        font-size: 4rem;
        padding-bottom: 2rem;
        text-transform: uppercase;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.9);
        letter-spacing: .03em;
        width: 600px;
      }

      .subtitle {
        font-size: 1.5rem;
        line-height: 2rem;
        padding-bottom: 1.5rem;
        text-shadow: 0 2px 4px rgba(0,0,0,0.9);
      }

      .right .item {
        height:50%;
        position: relative;
      }

      .right .overlay {
        position: absolute;
        top: 0px;
        width:100%;
        height:100%;
        background: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0.3) 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
        z-index:2;
      }

      .right .titlebox {
        max-width: 90%;
        position: absolute;
        bottom: 16px;
        left: 16px;
        right: 0;
        z-index:3;
        color: white;
      }

      .right .title {
        text-transform: uppercase;
        font-size: 1rem;
        text-shadow: 0 2px 4px rgba(0,0,0,0.9);
      }

      nuxeo-dam-project-list {
        margin-top:32px;
        --min-height: 300px;
      }

      .project {
        margin:12px;
        cursor: pointer;
      }

      @media (min-width: 1441px) {
        .project {

          width: calc(25% - 24px);
        }
      }

      @media (min-width: 1025px) and (max-width: 1440px) {
        .project {
          width: calc(33% - 24px);
        }
      }

      @media (min-width: 641px) and (max-width: 1024px) {
        .project {
          width: calc(50% - 24px);
        }
      }

      @media (max-width: 640px) {
        .project {
          width: calc(100% - 24px);
        }
      }

      .projects {
        margin:-12px;
      }

      h1 {
        margin-top:64px;
        margin-bottom:32px;
      }

      .widget {
        margin-bottom:16px;
      }

      .favorites {
        margin: -0.4em;
      }

      .container {
        padding-bottom:64px;
      }

    </style>

    <nuxeo-connection id="nxcon" user="{{user}}"></nuxeo-connection>

    <nuxeo-page-provider
                         id="configQuery"
                         page-size="20"
                         provider="PP_ExternalTemplate_DamDashboard_Configs"
                         schemas="dublincore,common,uid,homepage"
                         enrichers="thumbnail"
                         headers='{"fetch.document": "properties"}'
                         current-page="{{configs}}"
                         auto>
    </nuxeo-page-provider>

    <template is="dom-if" if="[[_show(configs,user)]]">
     <div class="layout horizontal highlight">
       
       
      <div class="left">
        <a href="[[_getNavigationUrl(config,0,item)]]">
          <img src ="[[_getThumbnailUrl(config,0,item)]]"/>
          <div class="overlay"></div>
          <div class="layout vertical titlebox">
            <div class="title"><span>[[_getTitle(config,0,item)]]</span></div>
            <div class="subtitle"><span>[[_getSubtitle(config,0,item)]]</span></div>
          </div>
        </a>
      </div>
      
      <div class="layout vertical right">
        <div class="item top">
          <a href="[[_getNavigationUrl(config,1,item)]]">
            <img src ="[[_getThumbnailUrl(config,1,item)]]"/>
            <div class="overlay"></div>
            <div class="titlebox">
              <div class="title"><span>[[_getTitle(config,1,item)]]</span></div>
              <div class="subtitle"><span>[[_getSubtitle(config,1,item)]]</span></div>
            </div>
          </a>
        </div>
        
        <div class="item">
          <a href="[[_getNavigationUrl(config,2,item)]]">
            <img src ="[[_getThumbnailUrl(config,2,item)]]"/>
            <div class="overlay"></div>
            <div class="titlebox">
              <div class="title"><span>[[_getTitle(config,2,item)]]</span></div>
              <div class="subtitle"><span>[[_getSubtitle(config,2,item)]]</span></div>
            </div>
          </a>
        </div>
      </div>
    </div>
    </template>  

</template>
  <script>
  Polymer({
    is: 'dam-home-single-image-layout',
    behaviors: [Nuxeo.LayoutBehavior],
   	properties: {

    },
    
    observers:['_onConfigsChanged(configs)'],

    refresh: function() {
      this.$.configQuery.fetch();
    },
    
    _onConfigsChanged: function(configs) {
      if (configs === undefined || configs.length === undefined || configs.length===0) {
        return;
      }
      this.set('config',configs[0]);
    },
    
    _getTitle: function(config,position,item) {
      var element = this.config.properties['homepage:elements'][position];
      return element.title;
    },

    _getSubtitle: function(config,position,item) {
      var element = this.config.properties['homepage:elements'][position];
      return element.subtitle;
    },
    
    _getThumbnailUrl: function(config,position,item) {
      var element = this.config.properties['homepage:elements'][position];
      return window.location.origin+"/nuxeo/nxfile/default/"+element.hero.uid+"/picture:views/2/content/preview.jpg";
    },
    
    _getNavigationUrl: function(config,position,item) {
      var element = this.config.properties['homepage:elements'][position];
      if (element.hyperlink)  {
        return element.hyperlink;
      }
      else
        {
      return window.location.origin+"/nuxeo/#!/doc/"+element.targetDocument.uid; 
        }
    },
       
    _show: function(configs, user) {
			if (!configs || configs.length === 0 ||
          configs[0].properties['homepage:elements'].length === 0 || !user) {
        return false;
      } else {
        return user.id && !user.id.includes('@');
      }
    }

  });
  </script>
</dom-module>
