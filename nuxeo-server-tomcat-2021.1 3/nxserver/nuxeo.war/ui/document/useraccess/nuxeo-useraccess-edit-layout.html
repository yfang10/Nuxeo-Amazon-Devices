<!--
`nuxeo-useraccess-edit-layout`
@group Nuxeo UI
@element nuxeo-useraccess-edit-layout
-->
<dom-module id="nuxeo-useraccess-edit-layout">
  <template>
    <style>
      *[role=widget] {
        padding: 5px;
      }
    </style>
    <nuxeo-input role="widget" value="{{document.properties.userAccess:fName}}" label="First Name" type="text" required="true"></nuxeo-input>

    <nuxeo-input role="widget" value="{{document.properties.userAccess:lName}}" label="Last Name" type="text" required="true"></nuxeo-input>
    
    <nuxeo-directory-suggestion role="widget" value="{{document.properties.userAccess:country}}" label="Country" directory-name="Approved_Locations"></nuxeo-directory-suggestion>

    <nuxeo-input role="widget" value="{{document.properties.userAccess:email}}" label="Email Address" type="text" pattern="^[a-z0-9!#$%&amp;&#x27;*+/&#x3D;?^_&#x60;{|}~-]+(?:\.[a-z0-9!#$%&amp;&#x27;*+/&#x3D;?^_&#x60;{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$" required="true"></nuxeo-input>
  </template>

  <script>
    Polymer({
      is: 'nuxeo-useraccess-edit-layout',
      behaviors: [Nuxeo.LayoutBehavior],
      properties: {

        /**
         * @doctype UserAccess
         */
        document: {
          type: Object,
        },

      },
      
      validate: function() {
        this.set("document.properties.dc:title",
                 this.document.properties['userAccess:fName'] + this.document.properties['userAccess:lName'] + '-' + this.document.properties['userAccess:email']);

        let valid = true;
        if (this) {
          const elements = this._getValidatableElements(this.root);
          for (let el, i = 0; i < elements.length; i++) {
            el = elements[i];
            valid = (el.validate ? el.validate() : el.checkValidity()) && valid;
          }
        }
        if (!valid) {
          return false;
        }
        return true;
      },

      _getValidatableElements(parent) {
        const nodes = parent.querySelectorAll('*');
        const submittable = [];
        for (let i = 0; i < nodes.length; i++) {
          const node = nodes[i];
          if (!node.disabled) {
            if (node.validate || node.checkValidity) {
              submittable.push(node);
            } else if (node.root) {
              Array.prototype.push.apply(submittable, this._getValidatableElements(node.root));
            }
          }
        }
        return submittable;
      }
    });
  </script>
</dom-module>
