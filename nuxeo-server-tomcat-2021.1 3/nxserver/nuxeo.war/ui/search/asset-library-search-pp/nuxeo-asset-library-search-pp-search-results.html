<!--
`nuxeo-asset-library-search-pp-search-results`
@group Nuxeo UI
@element nuxeo-asset-library-search-pp-search-results
-->
<dom-module id="nuxeo-asset-library-search-pp-search-results">
  <template>
    <style include="nuxeo-styles">
      nuxeo-data-table-cell {
          flex-wrap: wrap!important;
        }
        .hidden{
          background: transparent;
        }
    </style>
    <nuxeo-results name="asset-library-search-pp" nx-provider="[[nxProvider]]" selected-items="{{selectedItems}}" display-quick-filters display-sort sort-label="[[i18n('searchResults.sort.label')]]" sort-options="[[sortOptions]]">
      <nuxeo-data-grid name="grid" icon="nuxeo:view-thumbnails" class="results" empty-label="[[i18n('searchResults.noResults')]]" sort-label="[[i18n('searchResults.sort.label')]]" selection-enabled display-quick-filters>
        <template>
          <nuxeo-document-grid-thumbnail tabindex$="{{tabIndex}}" selected$="{{selected}}" doc="[[item]]" index="[[index]]" on-navigate="_navigate" selected-items="[[selectedItems]]">
          </nuxeo-document-grid-thumbnail>
        </template>
      </nuxeo-data-grid>

        <nuxeo-data-table class="results" settings-enabled empty-label="[[i18n('searchResults.noResults')]]" selection-enabled on-row-clicked="_navigate" icon="nuxeo:view-list" name="table">

  <nuxeo-data-table-column name="Title" field="dc:title" sort-by="dc:title" flex="100">
    <template>
      <nuxeo-document-thumbnail document="[[item]]"></nuxeo-document-thumbnail>
      <a class="ellipsis" href$="[[urlFor(item)]]" on-click="_navigate">[[item.title]]</a>
    </template>
  </nuxeo-data-table-column>

  <nuxeo-data-table-column
  name="Keywords"
  field="isskeyword:keywords"
  flex="50"
  class="column-keyword"
  >
  <template is="header">
    <a class="title ellipsis" >Keywords</a>
  </template>
  <template>
    <template is="dom-repeat" items="[[_filterKeywords(item.properties.isskeyword:keywords)]]" as="subject" observe="_updateKeywords" style="flex-wrap:wrap;">
      
      <nuxeo-tag  class$="[[_computeHidden(subject.ellipsis)]]" >[[subject.label]]</nuxeo-tag>
      <a>[[subject.ellipsis]]</a>
    </template>
  </template>
  </nuxeo-data-table-column>
  
  <nuxeo-data-table-column name="Modified" field="dc:modified" sort-by="dc:modified" flex="50">
    <template>
      [[formatDate(item.properties.dc:modified)]]
    </template>
  </nuxeo-data-table-column>

  <nuxeo-data-table-column name="Expired" field="dc:expired" sort-by="dc:expired" flex="50">
    <template>
      [[formatDate(item.properties.dc:expired)]]
    </template>
  </nuxeo-data-table-column>

  <nuxeo-data-table-column name="Last Contributor" field="dc:lastContributor" sort-by="dc:lastContributor" flex="50">
    <template>
      <nuxeo-user-tag user="[[item.properties.dc:lastContributor]]"></nuxeo-user-tag>
    </template>
  </nuxeo-data-table-column>
</nuxeo-data-table>

    </nuxeo-results>
  </template>
  <script>
    Polymer({
      is: 'nuxeo-asset-library-search-pp-search-results',
      behaviors: [Nuxeo.LayoutBehavior],
      properties: {
        nxProvider: Object,
        sortOptions: {
          type: Array,
          value: []
        }
      },

      attached: function() {
        this.sortOptions = [
          {field: 'dc:title', label: this.i18n('searchResults.sort.field.title'), order: 'asc'},
          {field: 'dc:created', label: this.i18n('searchResults.sort.field.created'), order: 'asc', selected: true},
          {field: 'dc:modified', label: this.i18n('searchResults.sort.field.modified'), order: 'desc'},
          {field: 'dc:lastContributor', label: this.i18n('searchResults.sort.field.lastContributor'), order: 'asc'},
          {field: 'state', label: this.i18n('searchResults.sort.field.state'), order: 'asc'},
          {field: 'dc:nature', label: this.i18n('searchResults.sort.field.nature'), order: 'asc'},
          {field: 'dc:coverage', label: this.i18n('searchResults.sort.field.coverage'), order: 'asc'}
        ];
      },

      _navigate: function(e) {
        this.fire('navigate', { doc: (e.model || e.detail).item, index: (e.model || e.detail).index });
      },
      
       _filterKeywords(keywords) {
          if (keywords && keywords.length > 10) {
            let sliceArr = keywords.slice(0, 10)
            sliceArr.push({
              ellipsis: '...'
            })
            return sliceArr
          }else if (keywords && keywords.length < 10) {
            return keywords;
          }

          return [];
        },

        _computeHidden(boolProp) {
          if (boolProp) return 'hidden';
        }
      
    });
  </script>
</dom-module>
