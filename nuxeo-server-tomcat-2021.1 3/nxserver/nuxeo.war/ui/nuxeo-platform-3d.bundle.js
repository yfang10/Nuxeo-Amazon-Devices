/*! For license information please see nuxeo-platform-3d.bundle.js.LICENSE.txt */
(self.webpackChunk_nuxeo_nuxeo_web_ui=self.webpackChunk_nuxeo_nuxeo_web_ui||[]).push([[921],{39393:(e,t,r)=>{"use strict";r.r(t);var a=r(11085);let n=function(e,t){var r,n,i,s,o;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new a.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:a.MOUSE.LEFT,ZOOM:a.MOUSE.MIDDLE,PAN:a.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return f.phi},this.getAzimuthalAngle=function(){return f.theta},this.reset=function(){l.target.copy(l.target0),l.object.position.copy(l.position0),l.object.zoom=l.zoom0,l.object.updateProjectionMatrix(),l.dispatchEvent(c),l.update(),m=d.NONE},this.update=(r=new a.Vector3,n=(new a.Quaternion).setFromUnitVectors(e.up,new a.Vector3(0,1,0)),i=n.clone().invert(),s=new a.Vector3,o=new a.Quaternion,function(){var e=l.object.position;return r.copy(e).sub(l.target),r.applyQuaternion(n),f.setFromVector3(r),l.autoRotate&&m===d.NONE&&C(2*Math.PI/60/60*l.autoRotateSpeed),f.theta+=v.theta,f.phi+=v.phi,f.theta=Math.max(l.minAzimuthAngle,Math.min(l.maxAzimuthAngle,f.theta)),f.phi=Math.max(l.minPolarAngle,Math.min(l.maxPolarAngle,f.phi)),f.makeSafe(),f.radius*=b,f.radius=Math.max(l.minDistance,Math.min(l.maxDistance,f.radius)),l.target.add(g),r.setFromSpherical(f),r.applyQuaternion(i),e.copy(l.target).add(r),l.object.lookAt(l.target),!0===l.enableDamping?(v.theta*=1-l.dampingFactor,v.phi*=1-l.dampingFactor):v.set(0,0,0),b=1,g.set(0,0,0),!!(y||s.distanceToSquared(l.object.position)>p||8*(1-o.dot(l.object.quaternion))>p)&&(l.dispatchEvent(c),s.copy(l.object.position),o.copy(l.object.quaternion),y=!1,!0)}),this.dispose=function(){l.domElement.removeEventListener("contextmenu",z,!1),l.domElement.removeEventListener("mousedown",N,!1),l.domElement.removeEventListener("wheel",U,!1),l.domElement.removeEventListener("touchstart",W,!1),l.domElement.removeEventListener("touchend",G,!1),l.domElement.removeEventListener("touchmove",q,!1),document.removeEventListener("mousemove",V,!1),document.removeEventListener("mouseup",H,!1),window.removeEventListener("keydown",B,!1)};var l=this,c={type:"change"},u={type:"start"},h={type:"end"},d={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},m=d.NONE,p=1e-6,f=new a.Spherical,v=new a.Spherical,b=1,g=new a.Vector3,y=!1,_=new a.Vector2,E=new a.Vector2,w=new a.Vector2,T=new a.Vector2,R=new a.Vector2,A=new a.Vector2,x=new a.Vector2,L=new a.Vector2,M=new a.Vector2;function O(){return Math.pow(.95,l.zoomSpeed)}function C(e){v.theta-=e}function S(e){v.phi-=e}var P,D=(P=new a.Vector3,function(e,t){P.setFromMatrixColumn(t,0),P.multiplyScalar(-e),g.add(P)}),k=function(){var e=new a.Vector3;return function(t,r){e.setFromMatrixColumn(r,1),e.multiplyScalar(t),g.add(e)}}(),I=function(){var e=new a.Vector3;return function(t,r){var n=l.domElement===document?l.domElement.body:l.domElement;if(l.object instanceof a.PerspectiveCamera){var i=l.object.position;e.copy(i).sub(l.target);var s=e.length();s*=Math.tan(l.object.fov/2*Math.PI/180),D(2*t*s/n.clientHeight,l.object.matrix),k(2*r*s/n.clientHeight,l.object.matrix)}else l.object instanceof a.OrthographicCamera?(D(t*(l.object.right-l.object.left)/l.object.zoom/n.clientWidth,l.object.matrix),k(r*(l.object.top-l.object.bottom)/l.object.zoom/n.clientHeight,l.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),l.enablePan=!1)}}();function j(e){l.object instanceof a.PerspectiveCamera?b/=e:l.object instanceof a.OrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom*e)),l.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function F(e){l.object instanceof a.PerspectiveCamera?b*=e:l.object instanceof a.OrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom/e)),l.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function N(e){if(!1!==l.enabled){if(e.preventDefault(),e.button===l.mouseButtons.ORBIT){if(!1===l.enableRotate)return;!function(e){_.set(e.clientX,e.clientY)}(e),m=d.ROTATE}else if(e.button===l.mouseButtons.ZOOM){if(!1===l.enableZoom)return;!function(e){x.set(e.clientX,e.clientY)}(e),m=d.DOLLY}else if(e.button===l.mouseButtons.PAN){if(!1===l.enablePan)return;!function(e){T.set(e.clientX,e.clientY)}(e),m=d.PAN}m!==d.NONE&&(document.addEventListener("mousemove",V,!1),document.addEventListener("mouseup",H,!1),l.dispatchEvent(u))}}function V(e){if(!1!==l.enabled)if(e.preventDefault(),m===d.ROTATE){if(!1===l.enableRotate)return;!function(e){E.set(e.clientX,e.clientY),w.subVectors(E,_);var t=l.domElement===document?l.domElement.body:l.domElement;C(2*Math.PI*w.x/t.clientWidth*l.rotateSpeed),S(2*Math.PI*w.y/t.clientHeight*l.rotateSpeed),_.copy(E),l.update()}(e)}else if(m===d.DOLLY){if(!1===l.enableZoom)return;!function(e){L.set(e.clientX,e.clientY),M.subVectors(L,x),M.y>0?j(O()):M.y<0&&F(O()),x.copy(L),l.update()}(e)}else if(m===d.PAN){if(!1===l.enablePan)return;!function(e){R.set(e.clientX,e.clientY),A.subVectors(R,T),I(A.x,A.y),T.copy(R),l.update()}(e)}}function H(e){!1!==l.enabled&&(document.removeEventListener("mousemove",V,!1),document.removeEventListener("mouseup",H,!1),l.dispatchEvent(h),m=d.NONE)}function U(e){!1===l.enabled||!1===l.enableZoom||m!==d.NONE&&m!==d.ROTATE||(e.preventDefault(),e.stopPropagation(),function(e){e.deltaY<0?F(O()):e.deltaY>0&&j(O()),l.update()}(e),l.dispatchEvent(u),l.dispatchEvent(h))}function B(e){!1!==l.enabled&&!1!==l.enableKeys&&!1!==l.enablePan&&function(e){switch(e.keyCode){case l.keys.UP:I(0,l.keyPanSpeed),l.update();break;case l.keys.BOTTOM:I(0,-l.keyPanSpeed),l.update();break;case l.keys.LEFT:I(l.keyPanSpeed,0),l.update();break;case l.keys.RIGHT:I(-l.keyPanSpeed,0),l.update()}}(e)}function W(e){if(!1!==l.enabled){switch(e.touches.length){case 1:if(!1===l.enableRotate)return;!function(e){_.set(e.touches[0].pageX,e.touches[0].pageY)}(e),m=d.TOUCH_ROTATE;break;case 2:if(!1===l.enableZoom)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+r*r);x.set(0,a)}(e),m=d.TOUCH_DOLLY;break;case 3:if(!1===l.enablePan)return;!function(e){T.set(e.touches[0].pageX,e.touches[0].pageY)}(e),m=d.TOUCH_PAN;break;default:m=d.NONE}m!==d.NONE&&l.dispatchEvent(u)}}function q(e){if(!1!==l.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===l.enableRotate)return;if(m!==d.TOUCH_ROTATE)return;!function(e){E.set(e.touches[0].pageX,e.touches[0].pageY),w.subVectors(E,_);var t=l.domElement===document?l.domElement.body:l.domElement;C(2*Math.PI*w.x/t.clientWidth*l.rotateSpeed),S(2*Math.PI*w.y/t.clientHeight*l.rotateSpeed),_.copy(E),l.update()}(e);break;case 2:if(!1===l.enableZoom)return;if(m!==d.TOUCH_DOLLY)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+r*r);L.set(0,a),M.subVectors(L,x),M.y>0?F(O()):M.y<0&&j(O()),x.copy(L),l.update()}(e);break;case 3:if(!1===l.enablePan)return;if(m!==d.TOUCH_PAN)return;!function(e){R.set(e.touches[0].pageX,e.touches[0].pageY),A.subVectors(R,T),I(A.x,A.y),T.copy(R),l.update()}(e);break;default:m=d.NONE}}function G(e){!1!==l.enabled&&(l.dispatchEvent(h),m=d.NONE)}function z(e){e.preventDefault()}l.domElement.addEventListener("contextmenu",z,!1),l.domElement.addEventListener("mousedown",N,!1),l.domElement.addEventListener("wheel",U,!1),l.domElement.addEventListener("touchstart",W,!1),l.domElement.addEventListener("touchend",G,!1),l.domElement.addEventListener("touchmove",q,!1),window.addEventListener("keydown",B,!1),this.update()};(n.prototype=Object.create(a.EventDispatcher.prototype)).constructor=n,Object.defineProperties(n.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}});var i=r(21536),s=r(66538),o=r(74153),l=r(14190),c=r(11085),u=r(11085);let h=function(e){this.manager=void 0!==e?e:u.DefaultLoadingManager};h.prototype={constructor:h,load:function(e,t,r,a){var n=this;new u.FileLoader(n.manager).load(e,(function(e){t(n.parse(JSON.parse(e)))}),r,a)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){function t(e){for(var t=atob(e),r=new ArrayBuffer(t.length),a=new Uint8Array(r),n=0;n<t.length;n++)a[n]=t.charCodeAt(n);return r}console.time("GLTFLoader");var r={buffers:{},bufferViews:{},accessors:{},textures:{},materials:{},meshes:{},nodes:{},scenes:{}},a=e.buffers;for(var n in a){var i=a[n];if("arraybuffer"===i.type){var s="data:application/octet-stream;base64,";0===i.uri.indexOf(s)&&(r.buffers[n]=t(i.uri.substr(s.length)))}}var o=e.bufferViews;for(var l in o){var c=o[l],h=r.buffers[c.buffer];r.bufferViews[l]=h.slice(c.byteOffset,c.byteOffset+c.byteLength)}var d={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},m={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},p=e.accessors;for(var f in p){var v=p[f],b=(h=r.bufferViews[v.bufferView],m[v.type]),g=new(0,d[v.componentType])(h,v.byteOffset,v.count*b);r.accessors[f]=new u.BufferAttribute(g,b)}var y={9728:u.NearestFilter,9729:u.LinearFilter,9984:u.NearestMipMapNearestFilter,9985:u.LinearMipMapNearestFilter,9986:u.NearestMipMapLinearFilter,9987:u.LinearMipMapLinearFilter},_={33071:u.ClampToEdgeWrapping,33648:u.MirroredRepeatWrapping,10497:u.RepeatWrapping},E=e.textures;for(var w in E){var T=E[w],R=new u.Texture;if(R.flipY=!1,T.source){var A=e.images[T.source];R.image=new Image,R.image.src=A.uri,R.needsUpdate=!0}if(T.sampler){var x=e.samplers[T.sampler];R.magFilter=y[x.magFilter],R.minFilter=y[x.minFilter],R.wrapS=_[x.wrapS],R.wrapT=_[x.wrapT]}r.textures[w]=R}var L=e.materials;for(var M in L){var O=L[M],C=new u.MeshPhongMaterial;C.name=O.name;var S=O.values;Array.isArray(S.diffuse)?C.color.fromArray(S.diffuse):"string"==typeof S.diffuse&&(C.map=r.textures[S.diffuse]),Array.isArray(S.emission)&&C.emissive.fromArray(S.emission),Array.isArray(S.specular)&&C.specular.fromArray(S.specular),void 0!==S.shininess&&(C.shininess=S.shininess),r.materials[M]=C}var P=e.meshes;for(var D in P){var k=P[D];(K=new u.Group).name=k.name;for(var I=k.primitives,j=0;j<I.length;j++){var F=I[j],N=F.attributes,V=new u.BufferGeometry;for(var H in F.indices&&V.setIndex(r.accessors[F.indices]),N){var U=N[H],B=r.accessors[U];switch(H){case"POSITION":V.setAttribute("position",B);break;case"NORMAL":V.setAttribute("normal",B);break;case"TEXCOORD_0":V.setAttribute("uv",B)}}O=r.materials[F.material],K.add(new u.Mesh(V,O))}r.meshes[D]=K}var W=e.nodes,q=new u.Matrix4;for(var G in W){var z=W[G],Y=new u.Group;if(Y.name=z.name,void 0!==z.translation&&Y.position.fromArray(z.translation),void 0!==z.rotation&&Y.quaternion.fromArray(z.rotation),void 0!==z.scale&&Y.scale.fromArray(z.scale),void 0!==z.matrix&&(q.fromArray(z.matrix),q.decompose(Y.position,Y.quaternion,Y.scale)),void 0!==z.meshes)for(j=0;j<z.meshes.length;j++){D=z.meshes[j];var K=r.meshes[D];Y.add(K.clone())}r.nodes[G]=Y}for(var G in W)for(z=W[G],j=0;j<z.children.length;j++){var $=z.children[j];r.nodes[G].add(r.nodes[$])}var X=e.scenes;for(var Z in X){var J=X[Z],Q=new u.Scene;for(j=0;j<J.nodes.length;j++)z=J.nodes[j],Q.add(r.nodes[z]);r.scenes[Z]=Q}return console.timeEnd("GLTFLoader"),{scene:r.scenes[e.scene]}}};var d=r(13068),m=r(11085);let p=(f=[],{add:function(e){f.push(e)},remove:function(e){var t=f.indexOf(e);-1!==t&&f.splice(t,1)},update:function(){for(var e=0;e<f.length;e++)f[e].update()}});var f;let v=function(e){this.running=!1,this.loop=!1,this.duration=0,this.startTime=0,this.interps=[],e&&this.createInterpolators(e)};v.prototype.createInterpolators=function(e){var t,r=e.length;for(t=0;t<r;t++){var a=new b(e[t]);this.interps.push(a),this.duration=Math.max(this.duration,a.duration)}},v.prototype.play=function(){this.running||(this.startTime=Date.now(),this.running=!0,p.add(this))},v.prototype.stop=function(){this.running=!1,p.remove(this)},v.prototype.update=function(){if(this.running){var e=(Date.now()-this.startTime)/1e3,t=e%this.duration;if(Math.floor(e/this.duration)>=1&&!this.loop){this.running=!1;var r=this.interps.length;for(a=0;a<r;a++)this.interps[a].interp(this.duration);this.stop()}else{var a;for(r=this.interps.length,a=0;a<r;a++)this.interps[a].interp(t)}}};let b=function(e){this.keys=e.keys,this.values=e.values,this.count=e.count,this.type=e.type,this.path=e.path,this.isRot=!1;var t=e.target;switch(t.updateMatrix(),t.matrixAutoUpdate=!0,this.targetNode=t,e.path){case"translation":this.target=t.position,this.originalValue=t.position.clone();break;case"rotation":this.target=t.quaternion,this.originalValue=t.quaternion.clone(),this.isRot=!0;break;case"scale":this.target=t.scale,this.originalValue=t.scale.clone()}this.duration=this.keys[this.count-1],this.vec1=new m.Vector3,this.vec2=new m.Vector3,this.vec3=new m.Vector3,this.quat1=new m.Quaternion,this.quat2=new m.Quaternion,this.quat3=new m.Quaternion};b.prototype.interp=function(e){var t;if(e==this.keys[0])this.isRot?this.quat3.set(this.values[0],this.values[1],this.values[2],this.values[3]):this.vec3.set(this.values[0],this.values[1],this.values[2]);else if(e<this.keys[0])this.isRot?(this.quat1.set(this.originalValue.x,this.originalValue.y,this.originalValue.z,this.originalValue.w),this.quat2.set(this.values[0],this.values[1],this.values[2],this.values[3]),m.Quaternion.slerp(this.quat1,this.quat2,this.quat3,e/this.keys[0])):(this.vec3.set(this.originalValue.x,this.originalValue.y,this.originalValue.z),this.vec2.set(this.values[0],this.values[1],this.values[2]),this.vec3.lerp(this.vec2,e/this.keys[0]));else if(e>=this.keys[this.count-1])this.isRot?this.quat3.set(this.values[4*(this.count-1)],this.values[4*(this.count-1)+1],this.values[4*(this.count-1)+2],this.values[4*(this.count-1)+3]):this.vec3.set(this.values[3*(this.count-1)],this.values[3*(this.count-1)+1],this.values[3*(this.count-1)+2]);else for(t=0;t<this.count-1;t++){var r=this.keys[t],a=this.keys[t+1];e>=r&&e<=a&&(this.isRot?(this.quat1.set(this.values[4*t],this.values[4*t+1],this.values[4*t+2],this.values[4*t+3]),this.quat2.set(this.values[4*(t+1)],this.values[4*(t+1)+1],this.values[4*(t+1)+2],this.values[4*(t+1)+3]),m.Quaternion.slerp(this.quat1,this.quat2,this.quat3,(e-r)/(a-r))):(this.vec3.set(this.values[3*t],this.values[3*t+1],this.values[3*t+2]),this.vec2.set(this.values[3*(t+1)],this.values[3*(t+1)+1],this.values[3*(t+1)+2]),this.vec3.lerp(this.vec2,(e-r)/(a-r))))}this.target&&this.copyValue(this.target)},b.prototype.copyValue=function(e){this.isRot?e.copy(this.quat3):e.copy(this.vec3)};var g=r(33737);(0,i.k)({_template:s.d`
    <style>
      :host {
        display: block;
      }

      #threed {
        position: relative;
        width: 100%;
        height: 100%;
      }

      #threed canvas {
        display: block;
        width: 100% !important;
      }

      #progress {
        position: absolute;
        top: 50%;
        left: 50%;
        padding: 16px;
        background: rgba(255, 255, 255, 0.5);
        transform: translate(-50%, -50%);
      }
    </style>
    <div id="threed">
      <paper-progress id="progress" hidden="true"></paper-progress>
    </div>
  `,is:"nuxeo-3d-viewer",behaviors:[l.z],properties:{loader:{type:String,value:"simple",observer:"_loaderChanged"},src:{type:String,observer:"_sourceChanged"},sphericalCoords:{type:Array,value:[0,0],notify:!0,reflectToAttribute:!0,observer:"_sphericalCoordsChanged"},setupFinished:{type:Boolean,readOnly:!0,value:!1,notify:!0}},listeners:{"iron-resize":"_resize","on-setup-finished":"load"},attached(){this.async(this.notifyResize,1e3)},ready(){this._setupDone=!1,this.$.threed.width=this.width,this.$.threed.height=this.height,this._setup(),this._loaderChanged()},load(){const e=function(e){return function(t){e===this.src&&(this.clear(),this._processLoad(t),this._resize(),this._render())}.bind(this)}.bind(this),t=function(e){return function(t){e===this.latestLoadTS&&(this.$.progress.value=t.loaded/t.total*100)}.bind(this)}.bind(this);this.src&&(this.latestLoadTS=Date.now(),this.$.progress.value=0,this.$.progress.hidden=!1,this.gltfLoader.load(this.src,e(this.src),t(this.latestLoadTS)))},clear(){if(this.scene){const e=this.scene.children;for(;e.length>0;)this._removeObject(e[0])}},_loaderChanged(){"complete"===this.loader?this.gltfLoader=new d.z:this.gltfLoader=new h},_removeObject(e){null!==e.parent&&e.parent.remove(e)},_sourceChanged(){this.load()},_sphericalCoordsChanged(){this.setCameraFromAngles(this.sphericalCoords[0],this.sphericalCoords[1])},_setup(){this._setupScene(),this._setupCameras(),this._setupLights(),this._setupRenderer(),this._setupControls(),this._setSetupFinished(!0)},_setupScene(){this.root=new c.Scene,this.scene=new c.Scene,this.root.add(this.scene);const e=new c.PlaneGeometry(.5,.5),t=new c.MeshPhongMaterial({color:16777215});this.ground=new c.Mesh(e,t),this.ground.rotation.x=-Math.PI/2,this.ground.scale.multiplyScalar(3),this.ground.receiveShadow=!0,this.ground.position.copy(new c.Vector3(0,-.6,0)),this.root.add(this.ground)},_setupCameras(){this.cameras={},this.camera=new c.PerspectiveCamera(25,.5,.001,2e3),this.root.add(this.camera),this._cameraComposition(this.camera)},_setupLights(){const e=new c.AmbientLight(16777215,.5);this.root.add(e);const t=new c.SpotLight(16777215,.5);t.position.set(0,5,0),t.target.position.set(0,0,0),t.shadow.camera.far=10,t.castShadow=!0,t.shadow.darkness=.001,t.shadow.bias=.01,t.shadow.mapSize.width=1024,t.shadow.mapSize.height=1024,this.root.add(t)},_setupRenderer(){this.renderer=new c.WebGLRenderer({antialias:!0,alpha:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMapSoft=!0,this.renderer.shadowMap.type=c.PCFSoftShadowMap,(0,o.vz)(this.$.threed).appendChild(this.renderer.domElement)},_setupControls(){this.controls=new n(this.camera,this.$.threed),this.controls.addEventListener("change",this._controlsUpdated.bind(this)),this._sphericalCoordsChanged()},_controlsUpdated(){this._render()},_resize(){if(this.setupFinished){let e;this.camera.aspect=this.$.threed.offsetWidth/this.$.threed.offsetHeight,this.camera.updateProjectionMatrix();const t=this.cameras.length;for(e=0;e<t;e++)this.cameras[e].aspect=this.$.threed.offsetWidth/this.$.threed.offsetHeight,this.cameras[e].updateProjectionMatrix();this.renderer.setSize(this.$.threed.clientWidth,this.$.threed.clientHeight),this._render()}},_render(){"complete"===this.loader&&g.m.update(this.scene,this.camera),this.renderer.render(this.root,this.camera)},setCameraFromAngles(e,t){if(!this.controls||null==e||null==t)return;this.controls.reset();const r=e%360*(Math.PI/180),a=t%360==0?1e-15:t%360*(Math.PI/180),n=this.cameraDistance;this.camera.position.set(-n*Math.cos(r)*Math.sin(a),n*Math.cos(a),n*Math.sin(r)*Math.sin(a)),this.controls.update()},_animate(){window.requestAnimationFrame(this._animate.bind(this)),p.update(),g.m.update(this.scene,this.camera),this.controls.update(),this._render()},_processLoad(e){const t=e.scene;if(e.cameras&&e.cameras.length)for(let t=0;t<e.cameras.length;t++){const r=e.cameras[t],a=r.parent.name;this.cameras[a]=r}if(e.animations&&e.animations.length)for(let t=0;t<e.animations.length;t++){const r=e.animations[t];r.loop=!0,r.play(),this.animations.push(r)}this._objectComposition(t),this.scene.add(t),this.$.progress.hidden=!0,this._animate()},_objectComposition(e){const t=new c.Matrix4;t.makeRotationAxis(new c.Vector3(0,1,0),Math.PI),e.matrix.multiply(t),e.rotation.setFromRotationMatrix(e.matrix);const r=new c.Box3;r.setFromObject(e);const a=(new c.Vector3).copy(r.max).sub(r.min),n=1/Math.max.apply(null,[a.x,a.y,a.z]),i=(new c.Vector3).sub(r.getCenter(new c.Vector3)),s=(new c.Matrix4).identity();s.makeTranslation(i.x,i.y,i.z),s.multiplyScalar(n),e.applyMatrix4(s);const o=function(e,t){e.geometry&&(e.castShadow=t,e.geometry.computeFaceNormals(),e.geometry.computeVertexNormals(),e.geometry.computeBoundingSphere(),e.geometry.elementsNeedUpdate=!0,e.geometry.verticesNeedUpdate=!0,e.geometry.normalsNeedUpdate=!0),e.material&&e.material.bumpMap&&(e.material.bumpScale=n)};o(e,!0),e.traverse((e=>{o(e,!0)}))},_cameraComposition(){this.sphericalCoords=[225,45],this.camera.fov=25,this.cameraDistance=4}}),r(49348);var y=r(34408),_=r(41608);(0,i.k)({_template:s.d`
    <style>
      :host {
        display: block;
      }

      nuxeo-3d-viewer {
        width: 100%;
        height: 40vh;
      }

      .title {
        color: #213f7d;
        font-size: 1.64rem;
      }

      .flex {
        font-size: 12px;
        margin: auto;
      }
    </style>

    <nuxeo-document id="doc" doc-id="[[document.uid]]"></nuxeo-document>

    <template is="dom-if" if="{{document.properties.file:content}}">
      <template is="dom-if" if="{{_hasItems(document.properties.threed:transmissionFormats)}}">
        <nuxeo-3d-viewer id="threedViewer" src="[[document.properties.threed:transmissionFormats.0.content.data]]">
        </nuxeo-3d-viewer>
      </template>
      <template is="dom-if" if="{{!_hasItems(document.properties.threed:transmissionFormats)}}">
        <p>[[i18n('threeDViewLayout.transmissionFormats.notAvailable')]]</p>
      </template>
    </template>
    <template is="dom-if" if="{{!document.properties.file:content}}">
      <nuxeo-dropzone value="{{document.properties.file:content}}"></nuxeo-dropzone>
    </template>
    <div class="horizontal layout center">
      <template is="dom-if" if="[[document.properties.file:content]]">
        <p class="title">
          <a href="[[document.properties.file:content.data]]">[[document.title]]</a>
        </p>
        <div class="horizontal flex end-justified layout">
          <nuxeo-delete-blob-button document="{{document}}" xpath="file:content"></nuxeo-delete-blob-button>
        </div>
      </template>
      <template is="dom-if" if="[[!document.properties.file:content]]">
        <p class="title">
          <span>[[document.title]]</span>
        </p>
      </template>
    </div>
  `,is:"nuxeo-3d-preview",properties:{document:{type:Object,notify:!0}},behaviors:[y.M,_.mB],created(){this._createMethodObserver("_valueChanged(document.properties.file:content)",!0)},_valueChanged(e){if(!e||e.data)return;const t={};t["file:content"]=this.document.properties["file:content"],this.$.doc.data={"entity-type":"document",repository:this.document.repository,uid:this.document.uid,properties:t},this.$.doc.put().then((e=>{this.document=e,this.notify({message:this.i18n(this.uploadedMessage)}),this.fire("document-updated")}))},_hasItems:e=>e.length>0}),(0,i.k)({_template:s.d`
    <style>
      :host {
        display: block;
      }

      .title {
        color: #213f7d;
        font-size: 1.64rem;
      }

      .render-views {
        @apply --layout-horizontal;
        @apply --layout-wrap;
      }

      .render-views > .item {
        @apply --layout-vertical;
        @apply --layout-center;
      }

      .render-views > .item label {
        color: #999;
      }

      .render-views > .item img {
        width: 200px;
      }
    </style>

    <p class="title">[[i18n('threeDViewLayout.renderViews.heading')]]</p>
    <template is="dom-if" if="{{_hasItems(document.properties.threed:renderViews)}}">
      <div class="render-views">
        <template is="dom-repeat" items="[[document.properties.threed:renderViews]]" as="renderView">
          <div class="item">
            <img src="[[renderView.thumbnail.data]]" on-tap="_setCoords" alt$="[[document.title]]" />
            <div>
              <label class="layout flex-2" id="label">[[renderView.title]]</label>
              <paper-icon-button
                icon="icons:file-download"
                on-tap="_downloadView"
                noink
                aria-labelledby="label"
              ></paper-icon-button>
              <paper-tooltip>[[i18n('threeDViewLayout.renderViews.download')]]</paper-tooltip>
            </div>
          </div>
        </template>
      </div>
    </template>
    <template is="dom-if" if="{{!_hasItems(document.properties.threed:renderViews)}}">
      <p>[[i18n('threeDViewLayout.renderViews.notAvailable')]]</p>
    </template>
  `,is:"nuxeo-3d-render-views",properties:{document:{type:Object,notify:!0}},behaviors:[_.mB],_hasItems:e=>e.length>0,_setCoords(e){this.fire("3d-viewer-coords-change",{azimuth:e.model.renderView.azimuth,zenith:e.model.renderView.zenith})},_downloadView(e){window.location.href=e.model.renderView.content.data}}),(0,i.k)({_template:s.d`
    <style>
      :host {
        display: block;
      }

      .title {
        color: #213f7d;
        font-size: 1.64rem;
      }

      .flex {
        font-size: 12px;
        margin: auto;
      }

      .format {
        display: inline-block;
        width: 100%;
      }

      .format-name {
        float: left;
        width: 25%;
      }

      .format-info {
        float: left;
        height: 100%;
        width: 65%;
      }

      .format-polygons {
        height: 50%;
        display: flex;
      }

      .format-textures {
        height: 50%;
        display: flex;
      }

      .format-buttons {
        float: left;
        width: 8%;
        display: flex;
      }

      .format-info-element {
        float: left;
      }
    </style>

    <p class="title">[[i18n('threeDViewLayout.transmissionFormats.heading')]]</p>
    <template is="dom-if" if="{{_hasItems(document.properties.threed:transmissionFormats)}}">
      <div class="transmission-formats">
        <template is="dom-repeat" items="[[document.properties.threed:transmissionFormats]]" as="format">
          <div class="format">
            <div class="format-name">
              <label class="layout flex-2">[[format.name]]</label>
            </div>
            <div class="format-info">
              <div class="format-polygons item">
                <iron-icon class="format-info-element" icon="image:details"></iron-icon>
                <span class="layout flex format-info-element">[[_getPolyInfo(format)]]</span>
                <template class="format-info-element" is="dom-if" if="{{format.info.geometry_lod_success}}">
                  <iron-icon icon="icons:done"></iron-icon>
                </template>
                <template class="format-info-element" is="dom-if" if="{{!format.info.geometry_lod_success}}">
                  <iron-icon icon="icons:warning"></iron-icon>
                </template>
                <span class="layout flex format-info-element"
                  >[[_getPolyNumber(format)]] [[i18n('threeDViewLayout.unit.polygons')]]</span
                >
              </div>
              <div class="format-textures item">
                <template is="dom-if" if="{{_hasTextures(format)}}">
                  <iron-icon class="format-info-element" icon="image:image"></iron-icon>
                  <span class="layout flex format-info-element">[[_getTexInfo(format)]]</span>
                  <template class="format-info-element" is="dom-if" if="{{format.info.texture_lod_success}}">
                    <iron-icon icon="icons:done"></iron-icon>
                  </template>
                  <template class="format-info-element" is="dom-if" if="{{!format.info.texture_lod_success}}">
                    <iron-icon icon="icons:warning"></iron-icon>
                  </template>
                  <span class="layout flex format-info-element">[[_getTexSize(format)]]</span>
                </template>
              </div>
            </div>
            <div class="format-buttons">
              <div>
                <paper-icon-button
                  icon="icons:visibility"
                  on-tap="_loadFormat"
                  noink
                  aria-labelledby="previewTooltip"
                ></paper-icon-button>
                <paper-tooltip id="previewTooltip"
                  >[[i18n('threeDViewLayout.transmissionFormats.preview')]]</paper-tooltip
                >
              </div>
              <div>
                <paper-icon-button
                  icon="icons:file-download"
                  on-tap="_downloadFormat"
                  noink
                  aria-labelledby="downloadTooltip"
                ></paper-icon-button>
                <paper-tooltip id="downloadTooltip"
                  >[[i18n('threeDViewLayout.transmissionFormats.download')]]</paper-tooltip
                >
              </div>
            </div>
          </div>
        </template>
      </div>
    </template>
    <template is="dom-if" if="{{!_hasItems(document.properties.threed:transmissionFormats)}}">
      <p>[[i18n('threeDViewLayout.transmissionFormats.notAvailable')]]</p>
    </template>
  `,is:"nuxeo-3d-transmission-formats",properties:{document:{type:Object,notify:!0}},behaviors:[_.mB],_hasItems:e=>e.length>0,_formatAsReadable(e,t,r){if((e=Number(e))<t)return`${e} ${r}`;const a=parseInt(Math.log(e)/Math.log(t),0),n=String("kMGTPE".charAt(a-1));return`${Math.round(e/t**a*10)/10} ${n}${r}`},_getPolyInfo(e){const t=null==e.percPoly?"":`${e.percPoly} %`,r=null==e.maxPoly?"":`< ${this._formatAsReadable(e.maxPoly,1e3,"")}`;return null!=e.percPoly&&null!=e.maxPoly?`${t} | ${r}`:t+r},_getPolyNumber(e){return this._formatAsReadable(e.info.polygons,1e3,"")},_hasTextures:e=>e.info.textures_size>0,_getTexInfo(e){const t=null==e.percTex?"":`${e.percTex} %`,r=null==e.maxTex?"":`< ${e.maxTex}`;return null!=e.percTex&&null!=e.maxTex?`${t} | ${r}`:t+r},_getTexSize(e){return this._hasTextures(e)?this._formatAsReadable(e.info.textures_size,1024,"B"):null},_loadFormat(e){this.fire("3d-viewer-content-change",{content:e.model.format.content.data})},_downloadFormat(e){window.location.href=e.model.format.content.data}}),r(60475)},89224:function(e){window,function(e){"use strict";var t=["extensions","buffers","bufferViews","images","videos","samplers","textures","shaders","programs","techniques","materials","accessors","meshes","cameras","lights","skins","nodes","animations","scenes"],r=Object.create(Object.prototype,{_rootDescription:{value:null,writable:!0},rootDescription:{set:function(e){this._rootDescription=e},get:function(){return this._rootDescription}},baseURL:{value:null,writable:!0},_isAbsolutePath:{value:function(e){var t=new RegExp("^"+window.location.protocol,"i");return!!e.match(t)}},resolvePathIfNeeded:{value:function(e){return this._isAbsolutePath(e)||/^data:/.test(e)?e:this.baseURL+e}},_resolvePathsForCategories:{value:function(e){e.forEach((function(e){var t=this.json[e];t&&Object.keys(t).forEach((function(e){var r=t[e];r.uri=this.resolvePathIfNeeded(r.uri)}),this)}),this)}},_json:{value:null,writable:!0},json:{enumerable:!0,get:function(){return this._json},set:function(e){this._json!==e&&(this._json=e,this._resolvePathsForCategories(["buffers","shaders","images","videos"]))}},_path:{value:null,writable:!0},getEntryDescription:{value:function(e,t){var r,a=t;return(r=this.rootDescription[a])?r?r[e]:null:(console.log("ERROR:CANNOT find expected category named:"+a),null)}},_stepToNextCategory:{value:function(){return this._state.categoryIndex=this.getNextCategoryIndex(this._state.categoryIndex+1),-1!==this._state.categoryIndex&&(this._state.categoryState.index=0,!0)}},_stepToNextDescription:{enumerable:!1,value:function(){var e=this._state.categoryState,t=e.keys;return t?(e.index++,e.keys=null,e.index>=t.length&&this._stepToNextCategory()):(console.log("INCONSISTENCY ERROR"),!1)}},hasCategory:{value:function(e){return!!this.rootDescription[e]}},_handleState:{value:function(){for(var e={buffers:this.handleBuffer,bufferViews:this.handleBufferView,shaders:this.handleShader,programs:this.handleProgram,techniques:this.handleTechnique,materials:this.handleMaterial,meshes:this.handleMesh,cameras:this.handleCamera,lights:this.handleLight,nodes:this.handleNode,scenes:this.handleScene,images:this.handleImage,animations:this.handleAnimation,accessors:this.handleAccessor,skins:this.handleSkin,samplers:this.handleSampler,textures:this.handleTexture,videos:this.handleVideo,extensions:this.handleExtension},r=!0;-1!==this._state.categoryIndex;){var a=t[this._state.categoryIndex],n=this._state.categoryState,i=n.keys;if(i||(n.keys=i=Object.keys(this.rootDescription[a]),!i||0!=i.length)){var s=a,o=i[n.index],l=this.getEntryDescription(o,s);if(l){if(e[s]&&!1===e[s].call(this,o,l,this._state.userInfo)){r=!1;break}this._stepToNextDescription()}else if(this.handleError){this.handleError("INCONSISTENCY ERROR: no description found for entry "+o),r=!1;break}}else this._stepToNextDescription()}this.handleLoadCompleted&&this.handleLoadCompleted(r)}},_loadJSONIfNeeded:{enumerable:!0,value:function(e){var t=this;if(this._json)e&&e(this.json);else{var r=this._path,a=r.lastIndexOf("/");this.baseURL=0!==a?r.substring(0,a+1):"";var n=new XMLHttpRequest;n.open("GET",r,!0),n.onreadystatechange=function(){4==n.readyState&&200==n.status&&(t.json=JSON.parse(n.responseText),e&&e(t.json))},n.send(null)}}},_buildLoader:{value:function(e){var t=this;this._loadJSONIfNeeded((function(r){t.rootDescription=r,e&&e(this)}))}},_state:{value:null,writable:!0},_getEntryType:{value:function(e){for(var r=t,a=0;a<r.length;a++)if(this.rootDescription[r[a]])return r[a];return null}},getNextCategoryIndex:{value:function(e){for(var r=e;r<t.length;r++)if(this.hasCategory(t[r]))return r;return-1}},load:{enumerable:!0,value:function(e,t){var r=this;this._buildLoader((function(a){var n=r.getNextCategoryIndex.call(r,0);-1!==n&&(r._state={userInfo:e,options:t,categoryIndex:n,categoryState:{index:"0"}},r._handleState())}))}},initWithPath:{value:function(e){return this._path=e,this._json=null,this}},_knownURLs:{writable:!0,value:{}},loaderContext:{value:function(){return void 0===this._knownURLs[this._path]&&(this._knownURLs[this._path]=Object.keys(this._knownURLs).length),"__"+this._knownURLs[this._path]}},initWithJSON:{value:function(e,t){return this.json=e,this.baseURL=t,t||console.log("WARNING: no base URL passed to Reader:initWithJSON"),this}}});e&&(e.glTFParser=r)}(e.exports)},13068:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{z:()=>glTFLoader});var _glTFLoaderUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(60475),_glTF_parser_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(89224),_glTF_parser_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_glTF_parser_js__WEBPACK_IMPORTED_MODULE_1__),_glTFShaders_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(33737),THREE=__webpack_require__(11085);let glTFLoader=function(){this.meshesRequested=0,this.meshesLoaded=0,this.pendingMeshes=[],this.animationsRequested=0,this.animationsLoaded=0,this.animations=[],this.shadersRequested=0,this.shadersLoaded=0,this.shaders={},this.loadRequests=[],_glTFShaders_js__WEBPACK_IMPORTED_MODULE_2__.m.removeAll(),THREE.Loader.call(this)};glTFLoader.prototype=new THREE.Loader,glTFLoader.prototype.constructor=glTFLoader,glTFLoader.prototype.load=function(url,callback){var theLoader=this;function RgbArraytoHex(e){return e?(255<<24)+(Math.floor(255*e[0])<<16)+(Math.floor(255*e[1])<<8)+Math.floor(255*e[2]):4294967295}function componentsPerElementForGLType(e){var t;switch(e){case"SCALAR":t=1;break;case"VEC2":t=2;break;case"VEC3":t=3;break;case"VEC4":case"MAT2":t=4;break;case"MAT3":t=9;break;case"MAT4":t=16}return t}function replaceShaderDefinitions(shader,material){var program=material.params.program,shaderParams=material.params.technique.parameters,shaderAttributes=material.params.technique.attributes,params={};for(var attribute in material.params.attributes){var pname=shaderAttributes[attribute],shaderParam=shaderParams[pname],semantic=shaderParam.semantic;semantic&&(params[attribute]=shaderParam)}var s=shader,r="";for(var pname in params){var param=params[pname],semantic=param.semantic;switch(r=eval("/"+pname+"/g"),semantic){case"POSITION":s=s.replace(r,"position");break;case"NORMAL":s=s.replace(r,"normal");break;case"TEXCOORD_0":s=s.replace(r,"uv");break;case"WEIGHT":s=s.replace(r,"skinWeight");break;case"JOINT":s=s.replace(r,"skinIndex")}}return s}function replaceShaderSemantics(e){var t=theLoader.shaders[e.params.vertexShader];t&&(t=replaceShaderDefinitions(t,e),theLoader.shaders[e.params.vertexShader]=t)}function createShaderMaterial(e){replaceShaderSemantics(e);var t=theLoader.shaders[e.params.fragmentShader];if(!t)return console.log("ERROR: Missing fragment shader definition:",e.params.fragmentShader),new THREE.MeshPhongMaterial;var r=theLoader.shaders[e.params.vertexShader];if(!r)return console.log("ERROR: Missing vertex shader definition:",e.params.vertexShader),new THREE.MeshPhongMaterial;var a=THREE.UniformsUtils.clone(e.params.uniforms);for(var n in e.params.uniforms){var i=e.params.uniforms[n],s=a[n];"t"==s.type&&(s.value=i.value)}return new THREE.RawShaderMaterial({fragmentShader:t,vertexShader:r,uniforms:a,transparent:e.params.transparent})}function LoadTexture(e){if(!e)return null;function t(e,t){var r=decodeURIComponent(t);return e?atob(r):r}function r(e,r){for(var a=t(e,r),n=new ArrayBuffer(a.length),i=new Uint8Array(n),s=0;s<a.length;s++)i[s]=a.charCodeAt(s);return n}var a=/^data:(.*?)(;base64)?,(.*)$/.exec(e);if(null!==a){var n=new THREE.Texture,i=function(e,a){a=void 0!==a?a:"";var n=e[1],i=!!e[2],s=e[3];switch(a){case"":case"text":return t(i,s);case"ArrayBuffer":return r(i,s);case"blob":var o=r(i,s);return new Blob([o],{type:n});case"document":return(new DOMParser).parseFromString(t(i,s),n);case"json":return JSON.parse(t(i,s));default:throw"Unhandled responseType: "+a}}(a,"blob");return function(e,t,r){var a=new Image;a.onload=function(){var e;e=a,n.image=e,n.needsUpdate=!0},a.src=e}(window.URL.createObjectURL(i)),n}return(new THREE.TextureLoader).load(e)}function CreateTexture(e,t){var r,a=null,n=null;if(t&&(r=t)){var i=e.getEntry(r);if(i){var s=e.getEntry(i.description.source);s&&(a=s.description.uri);var o=e.getEntry(i.description.sampler);o&&(n=o.description)}}return(r=LoadTexture(a))&&n&&(n.wrapS==WebGLRenderingContext.REPEAT&&(r.wrapS=THREE.RepeatWrapping),n.wrapT==WebGLRenderingContext.REPEAT&&(r.wrapT=THREE.RepeatWrapping),n.magFilter==WebGLRenderingContext.LINEAR&&(r.magFilter=THREE.LinearFilter)),r}var ClassicGeometry=function(){this.geometry=new THREE.BufferGeometry,this.totalAttributes=0,this.loadedAttributes=0,this.indicesLoaded=!1,this.finished=!1,this.onload=null,this.uvs=null,this.indexArray=null};ClassicGeometry.prototype.constructor=ClassicGeometry,ClassicGeometry.prototype.buildBufferGeometry=function(){var e=this.geometry;e.setIndex(new THREE.BufferAttribute(this.indexArray,1));var t={start:0,index:0,count:this.indexArray.length};e.groups.push(t),e.computeBoundingSphere()},ClassicGeometry.prototype.checkFinished=function(){this.indexArray&&this.loadedAttributes===this.totalAttributes&&(this.buildBufferGeometry(),this.finished=!0,this.onload&&this.onload())};var IndicesDelegate=function(){};IndicesDelegate.prototype.handleError=function(e,t){console.log("ERROR(IndicesDelegate):"+e+":"+t)},IndicesDelegate.prototype.convert=function(e,t){return new Uint16Array(e,0,t.indices.count)},IndicesDelegate.prototype.resourceAvailable=function(e,t){var r=t.geometry;return r.indexArray=e,r.checkFinished(),!0};var indicesDelegate=new IndicesDelegate,IndicesContext=function(e,t){this.indices=e,this.geometry=t},VertexAttributeDelegate=function(){};VertexAttributeDelegate.prototype.handleError=function(e,t){console.log("ERROR(VertexAttributeDelegate):"+e+":"+t)},VertexAttributeDelegate.prototype.convert=function(e,t){return e},VertexAttributeDelegate.prototype.bufferResourceAvailable=function(e,t){var r,a,n,i=t.geometry,s=t.attribute,o=t.semantic;if("POSITION"==o)r=new Float32Array(e,0,s.count*componentsPerElementForGLType(s.type)),i.geometry.setAttribute("position",new THREE.BufferAttribute(r,3));else if("NORMAL"==o)n=componentsPerElementForGLType(s.type),r=new Float32Array(e,0,s.count*n),i.geometry.setAttribute("normal",new THREE.BufferAttribute(r,3));else if("TEXCOORD_0"==o||"TEXCOORD"==o){for(n=componentsPerElementForGLType(s.type),r=new Float32Array(e,0,s.count*n),a=0;a<r.length/2;a++)r[2*a+1]=1-r[2*a+1];i.geometry.setAttribute("uv",new THREE.BufferAttribute(r,n))}else"WEIGHT"==o?(n=componentsPerElementForGLType(s.type),r=new Float32Array(e,0,s.count*n),i.geometry.setAttribute("skinWeight",new THREE.BufferAttribute(r,n))):"JOINT"==o&&(n=componentsPerElementForGLType(s.type),r=new Float32Array(e,0,s.count*n),i.geometry.setAttribute("skinIndex",new THREE.BufferAttribute(r,n)))},VertexAttributeDelegate.prototype.resourceAvailable=function(e,t){this.bufferResourceAvailable(e,t);var r=t.geometry;return r.loadedAttributes++,r.checkFinished(),!0};var vertexAttributeDelegate=new VertexAttributeDelegate,VertexAttributeContext=function(e,t,r){this.attribute=e,this.semantic=t,this.geometry=r},Mesh=function(){this.primitives=[],this.materialsPending=[],this.loadedGeometry=0,this.onCompleteCallbacks=[]};Mesh.prototype.addPrimitive=function(e,t){var r=this;e.onload=function(){r.loadedGeometry++,r.checkComplete()},this.primitives.push({geometry:e,material:t,mesh:null})},Mesh.prototype.onComplete=function(e){this.onCompleteCallbacks.push(e)},Mesh.prototype.checkComplete=function(){var e=this;this.onCompleteCallbacks.length&&this.primitives.length==this.loadedGeometry&&(this.onCompleteCallbacks.forEach((function(t){t(e)})),this.onCompleteCallbacks=[])},Mesh.prototype.attachToNode=function(e){var t=this;this.primitives.forEach((function(r){var a=r.material,n=a.params;if(a instanceof THREE.Material||(a=createShaderMaterial(a)),!t.skin){var i=new THREE.Mesh(r.geometry.geometry,a);if(i.castShadow=!0,e.add(i),a instanceof THREE.ShaderMaterial){var s=new _glTFShaders_js__WEBPACK_IMPORTED_MODULE_2__.r(a,n,i,theLoader.rootObj);_glTFShaders_js__WEBPACK_IMPORTED_MODULE_2__.m.add(s)}}}))};var Material=function(e){this.params=e},AnimationParameterDelegate=function(){};AnimationParameterDelegate.prototype.handleError=function(e,t){console.log("ERROR(AnimationParameterDelegate):"+e+":"+t)},AnimationParameterDelegate.prototype.convert=function(e,t){var r=t.parameter,a=null;switch(r.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":a=new Float32Array(e,0,r.count*componentsPerElementForGLType(r.type))}return a},AnimationParameterDelegate.prototype.resourceAvailable=function(e,t){var r=t.animation,a=t.parameter;return a.data=e,r.handleParameterLoaded(a),!0};var animationParameterDelegate=new AnimationParameterDelegate,AnimationParameterContext=function(e,t){this.parameter=e,this.animation=t},Animation=function(){this.totalParameters=0,this.loadedParameters=0,this.parameters={},this.finishedLoading=!1,this.onload=null};Animation.prototype.constructor=Animation,Animation.prototype.handleParameterLoaded=function(e){this.parameters[e.name]=e,this.loadedParameters++,this.checkFinished()},Animation.prototype.checkFinished=function(){this.loadedParameters===this.totalParameters&&(this.finishedLoading=!0,this.onload&&this.onload())};var InverseBindMatricesDelegate=function(){};InverseBindMatricesDelegate.prototype.handleError=function(e,t){console.log("ERROR(InverseBindMatricesDelegate):"+e+":"+t)},InverseBindMatricesDelegate.prototype.convert=function(e,t){var r=t.parameter,a=null;return"MAT4"===r.type&&(a=new Float32Array(e,0,r.count*componentsPerElementForGLType(r.type))),a},InverseBindMatricesDelegate.prototype.resourceAvailable=function(e,t){return t.skin.inverseBindMatrices=e,!0};var inverseBindMatricesDelegate=new InverseBindMatricesDelegate,InverseBindMatricesContext=function(e,t){this.parameter=e,this.skin=t},ShaderDelegate=function(){};ShaderDelegate.prototype.handleError=function(e,t){console.log("ERROR(ShaderDelegate):"+e+":"+t)},ShaderDelegate.prototype.convert=function(e,t){return e},ShaderDelegate.prototype.resourceAvailable=function(e,t){return theLoader.shadersLoaded++,theLoader.shaders[t.id]=e,!0};var shaderDelegate=new ShaderDelegate,ShaderContext=function(e,t){this.id=e,this.uri=t},ResourceEntry=function(e,t,r){this.entryID=e,this.object=t,this.description=r},Resources=function(){this._entries={}};Resources.prototype.setEntry=function(e,t,r){e?(this._entries[e]&&console.warn("entry["+e+"] is being overwritten"),this._entries[e]=new ResourceEntry(e,t,r)):console.error("No EntryID provided, cannot store",r)},Resources.prototype.getEntry=function(e){return this._entries[e]},Resources.prototype.clearEntries=function(){this._entries={}};var LoadDelegate=function(){};LoadDelegate.prototype.loadCompleted=function(e,t){e.call(Window,t)};var ThreeGLTFLoader=Object.create(_glTF_parser_js__WEBPACK_IMPORTED_MODULE_1__.glTFParser,{load:{enumerable:!0,value:function(e,t){this.resources=new Resources,this.cameras=[],this.lights=[],this.animations=[],this.joints={},_glTFLoaderUtils_js__WEBPACK_IMPORTED_MODULE_0__.k.init(),_glTF_parser_js__WEBPACK_IMPORTED_MODULE_1__.glTFParser.load.call(this,e,t)}},cameras:{enumerable:!0,writable:!0,value:[]},lights:{enumerable:!0,writable:!0,value:[]},animations:{enumerable:!0,writable:!0,value:[]},handleBuffer:{value:function(e,t,r){return this.resources.setEntry(e,null,t),t.type="ArrayBuffer",!0}},handleBufferView:{value:function(e,t,r){this.resources.setEntry(e,null,t);var a=this.resources.getEntry(t.buffer);return t.type="ArrayBufferView",this.resources.getEntry(e).buffer=a,!0}},handleShader:{value:function(e,t,r){this.resources.setEntry(e,null,t);var a={id:e,uri:t.uri},n=new ShaderContext(e,t.uri);return theLoader.shadersRequested++,_glTFLoaderUtils_js__WEBPACK_IMPORTED_MODULE_0__.k.getFile(a,shaderDelegate,n),!0}},handleProgram:{value:function(e,t,r){return this.resources.setEntry(e,null,t),!0}},handleTechnique:{value:function(e,t,r){return t.refCount=0,this.resources.setEntry(e,null,t),!0}},createShaderParams:{value:function(e,t,r,a,n){var i=this.resources.getEntry(a);if(r.uniforms={},r.attributes={},r.program=i,r.technique=n,i){for(var s in r.fragmentShader=i.description.fragmentShader,r.vertexShader=i.description.vertexShader,n.uniforms){var o,l,c=n.uniforms[s],u=n.parameters[c],h=u.type,d=u.count,m=t[c],p="";switch(h){case WebGLRenderingContext.FLOAT:p="f",o=u.value,"transparency"==c&&(o=m,r.transparent=!0);break;case WebGLRenderingContext.FLOAT_VEC2:if(p="v2",o=new THREE.Vector2,u&&u.value){var f=u.value;o.fromArray(f)}m&&o.fromArray(m);break;case WebGLRenderingContext.FLOAT_VEC3:if(p="v3",o=new THREE.Vector3,u&&u.value){var v=u.value;o.fromArray(v)}m&&o.fromArray(m);break;case WebGLRenderingContext.FLOAT_VEC4:if(p="v4",o=new THREE.Vector4,u&&u.value){var b=u.value;o.fromArray(b)}m&&o.fromArray(m);break;case WebGLRenderingContext.FLOAT_MAT2:console.log("Warning: FLOAT_MAT2");break;case WebGLRenderingContext.FLOAT_MAT3:if(p="m3",o=new THREE.Matrix3,u&&u.value){var g=u.value;o.fromArray(g)}m&&o.fromArray(m);break;case WebGLRenderingContext.FLOAT_MAT4:if(void 0!==d){p="m4v",o=new Array(d);for(var y=0;y<d;y++)o[y]=new THREE.Matrix4;if(l=d,u&&u.value){var _=u.value;o.fromArray(_)}m&&o.fromArray(m)}else{if(p="m4",o=new THREE.Matrix4,u&&u.value){var E=u.value;o.fromArray(E)}m&&o.fromArray(m)}break;case WebGLRenderingContext.SAMPLER_2D:p="t",o=m?CreateTexture(this.resources,m):null;break;default:throw new Error("Unknown shader uniform param type: "+h+" - "+theLoader.idx[h])}var w={type:p,value:o,length:l};r.uniforms[s]=w}for(var T in n.attributes){c=n.attributes[T];var R=n.parameters[c],A={type:R.type,semantic:R.semantic};r.attributes[T]=A}}}},threeJSMaterialType:{value:function(e,t,r){var a,n=t.extensions,i=n?n.KHR_materials_common:null,s=null;if(i){switch(i.technique){case"BLINN":case"PHONG":s=THREE.MeshPhongMaterial;break;case"LAMBERT":s=THREE.MeshLambertMaterial;break;default:s=THREE.MeshBasicMaterial}for(prop in i.doubleSided&&(r.side=THREE.DoubleSide),i.transparent&&(r.transparent=!0),a={},i.values)a[prop]=i.values[prop]}else{var o=t.technique?this.resources.getEntry(t.technique):null;a=t.values;var l=o.description;++l.refCount;var c=l.program;this.createShaderParams(e,a,r,c,l),s=Material}a.diffuse&&"string"==typeof a.diffuse&&(r.map=CreateTexture(this.resources,a.diffuse)),a.reflective&&"string"==typeof a.reflective&&(r.envMap=CreateTexture(this.resources,a.reflective));var u=a.shininesss||a.shininess,h=null;r.map||(h=a.diffuse);var d=1;return a.hasOwnProperty("transparency")&&(d=a.transparency),r.color=RgbArraytoHex(h),r.opacity=d,r.transparent=d<1,r.map&&-1!=r.map.sourceFile.toLowerCase().indexOf(".png")&&(r.transparent=!0),void 0!==u&&(r.shininess=Math.max(u,1e-4)),delete r.ambient,void 0!==a.ambient&&a.ambient,void 0!==a.emission&&(r.emissive=RgbArraytoHex(a.emission)),void 0!==a.specular&&(r.specular=RgbArraytoHex(a.specular)),s}},handleMaterial:{value:function(e,t,r){var a={},n=new(this.threeJSMaterialType(e,t,a))(a);return this.resources.setEntry(e,n,t),!0}},handleMesh:{value:function(e,t,r){var a=new Mesh;this.resources.setEntry(e,a,t);var n=t.primitives;if(!n)return console.log("MISSING_PRIMITIVES for mesh:"+e),!1;for(var i=0;i<n.length;i++){var s=n[i];if(s.mode===WebGLRenderingContext.TRIANGLES){var o=new ClassicGeometry,l=this.resources.getEntry(s.material);a.addPrimitive(o,l.object);var c=Object.keys(s.attributes);c.forEach((function(e){o.totalAttributes++}),this);var u=this.resources.getEntry(s.indices),h={bufferView:this.resources.getEntry(u.description.bufferView),byteOffset:u.description.byteOffset,count:u.description.count,id:u.entryID,componentType:u.description.componentType,type:u.description.type},d=new IndicesContext(h,o),m={indicesObject:h,indicesDelegate,indicesContext:d};theLoader.scheduleLoad((function(e){var t=_glTFLoaderUtils_js__WEBPACK_IMPORTED_MODULE_0__.k.getBuffer(e.indicesObject,e.indicesDelegate,e.indicesContext);t&&e.indicesDelegate.resourceAvailable(t,e.indicesContext)}),m),c.forEach((function(e){var r,a=s.attributes[e],n=this.resources.getEntry(a);if(n)(r=n.object).id=a,i=this.resources.getEntry(r.bufferView);else{(r=t.attributes[a]).id=a,this.resources.setEntry(a,r,r);var i=this.resources.getEntry(r.bufferView);n=this.resources.getEntry(a)}var l={bufferView:i,byteOffset:r.byteOffset,byteStride:r.byteStride,count:r.count,max:r.max,min:r.min,componentType:r.componentType,type:r.type,id:a},c=new VertexAttributeContext(l,e,o),u={attributeObject:l,vertexAttributeDelegate,attribContext:c};theLoader.scheduleLoad((function(e){var t=_glTFLoaderUtils_js__WEBPACK_IMPORTED_MODULE_0__.k.getBuffer(e.attributeObject,e.vertexAttributeDelegate,e.attribContext);t&&e.vertexAttributeDelegate.resourceAvailable(t,e.attribContext)}),u)}),this)}}return!0}},handleCamera:{value:function(e,t,r){var a;if("perspective"==t.type){var n=t.perspective.znear,i=t.perspective.zfar,s=t.perspective.yfov,o=t.perspective.xfov,l=t.perspective.aspect_ratio;l||(l=1),void 0===o&&s&&(o=s*l),void 0===s&&o&&(s=o/l),o&&(o=THREE.Math.radToDeg(o),a=new THREE.PerspectiveCamera(o,l,n,i))}else a=new THREE.OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,n,i);return a&&this.resources.setEntry(e,a,t),!0}},handleLight:{value:function(e,t,r){var a=null,n=t.type;if(n&&t[n]){var i=RgbArraytoHex(t[n].color);switch(n){case"directional":(a=new THREE.DirectionalLight(i)).position.set(0,0,1);break;case"point":a=new THREE.PointLight(i);break;case"spot ":(a=new THREE.SpotLight(i)).position.set(0,0,1);break;case"ambient":a=new THREE.AmbientLight(i)}}return a&&this.resources.setEntry(e,a,t),!0}},addPendingMesh:{value:function(e,t){theLoader.pendingMeshes.push({mesh:e,node:t})}},handleNode:{value:function(e,t,r){var a=null;t.jointName?((a=new THREE.Bone).jointName=t.jointName,this.joints[t.jointName]=e):a=new THREE.Object3D,a.name=t.name,a.glTFID=e,a.glTF=t,this.resources.setEntry(e,a,t);var n=t.matrix;if(n)a.matrixAutoUpdate=!1,a.applyMatrix4((new THREE.Matrix4).set(n[0],n[4],n[8],n[12],n[1],n[5],n[9],n[13],n[2],n[6],n[10],n[14],n[3],n[7],n[11],n[15]));else{var i=t.translation,s=t.rotation,o=t.scale,l=i?new THREE.Vector3(i[0],i[1],i[2]):new THREE.Vector3,c=s?new THREE.Quaternion(s[0],s[1],s[2],s[3]):new THREE.Quaternion,u=o?new THREE.Vector3(o[0],o[1],o[2]):new THREE.Vector3(1,1,1),h=new THREE.Matrix4;h.compose(l,c,u),a.matrixAutoUpdate=!1,a.applyMatrix(h)}var d,m=this;if(t.meshes&&(t.meshInstances={},t.skin&&(d=this.resources.getEntry(t.skin)),t.meshes.forEach((function(e){var r=this.resources.getEntry(e);theLoader.meshesRequested++,r.object.onComplete((function(n){m.addPendingMesh(n,a),t.meshInstances[e]=r.object,d&&(n.skin=d,t.instanceSkin=d.object),theLoader.meshesLoaded++,theLoader.checkComplete()}))}),this)),t.camera){var p=this.resources.getEntry(t.camera);p&&(a.add(p.object),this.cameras.push(p.object))}if(t.extensions&&t.extensions.KHR_materials_common&&t.extensions.KHR_materials_common.light){var f=t.extensions.KHR_materials_common.light,v=this.resources.getEntry(f);v&&(a.add(v.object),this.lights.push(v.object))}return!0}},handleExtension:{value:function(e,t,r){if("KHR_materials_common"===e){var a=t.lights;for(lightID in a){var n=a[lightID];this.handleLight(lightID,n)}}return!0}},buildNodeHirerachy:{value:function(e,t){var r=this.resources.getEntry(e),a=r.object;t.add(a);var n=r.description.children;return n&&n.forEach((function(e){this.buildNodeHirerachy(e,a)}),this),a}},buildSkin:{value:function(e){var t=e.glTF,r=t.instanceSkin,a=t.skeletons;r&&a.forEach((function(a){var n=this.resources.getEntry(a);if(n){var i=n.object;for(meshID in e.add(i),t.meshInstances){var s=t.meshInstances[meshID],o=null;s.primitives.forEach((function(t){var n=t.material,i=n.params;if(n instanceof THREE.Material||(n=createShaderMaterial(n)),o=new THREE.SkinnedMesh(t.geometry.geometry,n,!1),t.geometry.geometry,o){n.skinning=!0;var s,l=r.jointNames,c=[],u=[],h=[],d=l.length;for(s=0;s<d;s++){var m=l[s],p=this.joints[m],f=this.resources.getEntry(p).object;if(f){f.skin=o,c.push(f),u.push(f);var v=r.inverseBindMatrices,b=(new THREE.Matrix4).set(v[16*s+0],v[16*s+4],v[16*s+8],v[16*s+12],v[16*s+1],v[16*s+5],v[16*s+9],v[16*s+13],v[16*s+2],v[16*s+6],v[16*s+10],v[16*s+14],v[16*s+3],v[16*s+7],v[16*s+11],v[16*s+15]);h.push(b)}else console.log("WARNING: jointName:"+m+" cannot be found in skeleton:"+a)}o.bind(new THREE.Skeleton(u,h,!1),r.bindShapeMatrix)}if(o&&(o.castShadow=!0,e.add(o),n instanceof THREE.ShaderMaterial)){i.joints=c;var g=new g(n,i,o,theLoader.rootObj);_glTFShaders_js__WEBPACK_IMPORTED_MODULE_2__.m.add(g)}}),this)}}}),this)}},buildSkins:{value:function(e){e.glTF&&e.glTF.instanceSkin&&this.buildSkin(e);var t=e.children;t&&t.forEach((function(e){this.buildSkins(e)}),this)}},createMeshAnimations:{value:function(e){this.buildSkins(e)}},handleScene:{value:function(e,t,r){return t.nodes?(t.nodes.forEach((function(e){this.buildNodeHirerachy(e,r.rootObj)}),this),this.delegate&&this.delegate.loadCompleted(r.callback,r.rootObj),theLoader.loadAllAssets(),!0):(console.log("ERROR: invalid file required nodes property is missing from scene"),!1)}},handleImage:{value:function(e,t,r){return this.resources.setEntry(e,null,t),!0}},addNodeAnimationChannel:{value:function(e,t,r){this.nodeAnimationChannels||(this.nodeAnimationChannels={}),this.nodeAnimationChannels[e]||(this.nodeAnimationChannels[e]=[]),this.nodeAnimationChannels[e].push(r)}},createAnimations:{value:function(){for(var e in this.nodeAnimationChannels){var t=this.nodeAnimationChannels[e],r=(t.length,new THREE.glTFAnimation(t));r.name="animation_"+e,this.animations.push(r)}}},buildAnimation:{value:function(e){var t,r=[],a=e.channels.length;for(t=0;t<a;t++){var n=e.channels[t],i=e.samplers[n.sampler];if(i){var s=e.parameters[i.input];if(s&&s.data){var o=e.parameters[i.output];if(o&&o.data){var l=n.target,c=this.resources.getEntry(l.id);if(c){var u=l.path,h={keys:s.data,values:o.data,count:s.count,target:c.object,path:u,type:i.interpolation};this.addNodeAnimationChannel(l.id,n,h),r.push(h)}}}}}}},handleAnimation:{value:function(e,t,r){theLoader.animationsRequested++;var a=new Animation;a.name=e,a.onload=function(){theLoader.animationsLoaded++,theLoader.animations.push(a),theLoader.checkComplete()},a.channels=t.channels,a.samplers=t.samplers,this.resources.setEntry(e,a,t);var n=t.parameters;return n?(Object.keys(n).forEach((function(e){a.totalParameters++}),this),Object.keys(n).forEach((function(e){var t=n[e],r=this.resources.getEntry(t);r=r.object;var i={bufferView:this.resources.getEntry(r.bufferView),byteOffset:r.byteOffset,count:r.count,componentType:r.componentType,type:r.type,id:r.bufferView,name:e},s=new AnimationParameterContext(i,a),o={paramObject:i,animationParameterDelegate,paramContext:s};theLoader.scheduleLoad((function(e){var t=_glTFLoaderUtils_js__WEBPACK_IMPORTED_MODULE_0__.k.getBuffer(e.paramObject,e.animationParameterDelegate,e.paramContext);t&&e.animationParameterDelegate.resourceAvailable(t,e.paramContext)}),o)}),this),!0):(console.log("MISSING_PARAMETERS for animation:"+e),!1)}},handleAccessor:{value:function(e,t,r){return this.resources.setEntry(e,t,t),!0}},handleSkin:{value:function(e,t,r){var a={},n=t.bindShapeMatrix;a.bindShapeMatrix=(new THREE.Matrix4).set(n[0],n[4],n[8],n[12],n[1],n[5],n[9],n[13],n[2],n[6],n[10],n[14],n[3],n[7],n[11],n[15]),a.jointNames=t.jointNames;var i=this.resources.getEntry(t.inverseBindMatrices);i=i.description,a.inverseBindMatricesDescription=i,a.inverseBindMatricesDescription.id=t.inverseBindMatrices;var s={bufferView:this.resources.getEntry(i.bufferView),byteOffset:i.byteOffset,count:i.count,componentType:i.componentType,type:i.type,id:i.bufferView,name:a.inverseBindMatricesDescription.id},o=new InverseBindMatricesContext(s,a),l={paramObject:s,inverseBindMatricesDelegate,context:o};theLoader.scheduleLoad((function(e){var t=_glTFLoaderUtils_js__WEBPACK_IMPORTED_MODULE_0__.k.getBuffer(e.paramObject,e.inverseBindMatricesDelegate,e.context);t&&e.inverseBindMatricesDelegate.resourceAvailable(t,e.context)}),l);var c=this.resources.getEntry(a.inverseBindMatricesDescription.bufferView);return a.inverseBindMatricesDescription.bufferView=c.object,this.resources.setEntry(e,a,t),!0}},handleSampler:{value:function(e,t,r){return this.resources.setEntry(e,t,t),!0}},handleTexture:{value:function(e,t,r){return this.resources.setEntry(e,null,t),!0}},handleError:{value:function(e){throw new Error(e)}},_delegate:{value:new LoadDelegate,writable:!0},delegate:{enumerable:!0,get:function(){return this._delegate},set:function(e){this._delegate=e}}}),Context=function(e,t){this.rootObj=e,this.callback=t},rootObj=new THREE.Object3D,self=this,loader=Object.create(ThreeGLTFLoader);return loader.initWithPath(url),loader.load(new Context(rootObj,(function(e){})),null),this.loader=loader,this.callback=callback,this.rootObj=rootObj,rootObj},glTFLoader.prototype.scheduleLoad=function(e,t){this.loadRequests.push({fn:e,data:t})},glTFLoader.prototype.loadAllAssets=function(){for(var e=0,t=this.loadRequests.length;e<t;e++){var r=this.loadRequests[e];r.fn(r.data)}},glTFLoader.prototype.callLoadedCallback=function(){var e={scene:this.rootObj,cameras:this.loader.cameras,animations:this.loader.animations,shaders:this.loader.shaders};this.callback(e)},glTFLoader.prototype.checkComplete=function(){if(this.meshesLoaded==this.meshesRequested&&this.shadersLoaded==this.shadersRequested&&this.animationsLoaded==this.animationsRequested){for(var e=0;e<this.pendingMeshes.length;e++){var t=this.pendingMeshes[e];t.mesh.attachToNode(t.node)}for(e=0;e<this.animationsLoaded;e++){var r=this.animations[e];this.loader.buildAnimation(r)}this.loader.createAnimations(),this.loader.createMeshAnimations(this.rootObj),_glTFShaders_js__WEBPACK_IMPORTED_MODULE_2__.m.bindShaderParameters(this.rootObj),this.callLoadedCallback()}}},60475:(e,t,r)=>{"use strict";r.d(t,{k:()=>a});let a=Object.create(Object,{MISSING_DESCRIPTION:{value:"MISSING_DESCRIPTION"},INVALID_PATH:{value:"INVALID_PATH"},INVALID_TYPE:{value:"INVALID_TYPE"},XMLHTTPREQUEST_STATUS_ERROR:{value:"XMLHTTPREQUEST_STATUS_ERROR"},NOT_FOUND:{value:"NOT_FOUND"},ARRAY_BUFFER:{value:"ArrayBuffer"},_streams:{value:{},writable:!0},_streamsStatus:{value:{},writable:!0},_resources:{value:{},writable:!0},_resourcesStatus:{value:{},writable:!0},init:{value:function(){this._streams={},this._streamsStatus={},this._resources={},this._resourcesStatus={}}},_containsResource:{enumerable:!1,value:function(e){return!!this._resources[e]}},_storeResource:{enumerable:!1,value:function(e,t){e?(this._containsResource[e]&&console.log("WARNING: resource:"+e+" is already stored, overriding"),this._resources[e]=t):console.log("ERROR: entry does not contain id, cannot store")}},_getResource:{enumerable:!1,value:function(e){return this._resources[e]}},_loadStream:{value:function(e,t,r){function n(e,t){var r=decodeURIComponent(t);return e?atob(r):r}function i(e,t){for(var r=n(e,t),a=new ArrayBuffer(r.length),i=new Uint8Array(a),s=0;s<r.length;s++)i[s]=r.charCodeAt(s);return a}var s=/^data:(.*?)(;base64)?,(.*)$/.exec(e);if(null===s)if(t)if(e){var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType=t===this.ARRAY_BUFFER?"arraybuffer":"text",o.setRequestHeader("If-Modified-Since","Sat, 01 Jan 1970 00:00:00 GMT"),o.onload=function(t){200==o.status||206==o.status?r.streamAvailable(e,o.response):r.handleError(a.XMLHTTPREQUEST_STATUS_ERROR,this.status)},o.send(null)}else r.handleError(a.INVALID_PATH);else r.handleError(a.INVALID_TYPE,null);else r.streamAvailable(e,function(e,t){t=void 0!==t?t:"";var r=e[1],a=!!e[2],s=e[3];switch(t){case"":case"text":return n(a,s);case"ArrayBuffer":return i(a,s);case"blob":var o=i(a,s);return new Blob([o],{type:r});case"document":return(new DOMParser).parseFromString(n(a,s),r);case"json":return JSON.parse(n(a,s));default:throw"Unhandled responseType: "+t}}(s,t))}},send:{value:0,writable:!0},requested:{value:0,writable:!0},_handleRequest:{value:function(e){this._resourcesStatus[e.id]?this._resourcesStatus[e.id]++:this._resourcesStatus[e.id]=1;var t=this._streamsStatus[e.uri];if(t&&"loading"===t.status)t.requests.push(e);else{this._streamsStatus[e.uri]={status:"loading",requests:[e]};var r=this,a={streamAvailable:function(e,t){r._streamsStatus[e].requests.forEach((function(e){var a=t.slice(e.range[0],e.range[1]),n=e.delegate.convert(a,e.ctx);r._storeResource(e.id,n),e.delegate.resourceAvailable(n,e.ctx),--r._resourcesStatus[e.id]}),this),delete r._streamsStatus[e]},handleError:function(t,r){e.delegate.handleError(t,r)}};this._loadStream(e.uri,e.type,a)}}},_elementSizeForGLType:{value:function(e,t){var r=0;switch(t){case"SCALAR":r=1;break;case"VEC2":r=2;break;case"VEC3":r=3;break;case"VEC4":case"MAT2":r=4;break;case"MAT3":r=9;break;case"MAT4":r=16}switch(e){case WebGLRenderingContext.FLOAT:return Float32Array.BYTES_PER_ELEMENT*r;case WebGLRenderingContext.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT*r;case WebGLRenderingContext.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT*r;default:return null}}},_handleWrappedBufferViewResourceLoading:{value:function(e,t,r){var a=e.bufferView,n=a.buffer,i=e.byteOffset+a.description.byteOffset,s=[i,this._elementSizeForGLType(e.componentType,e.type)*e.count+i];this._handleRequest({id:e.id,range:s,type:n.description.type,uri:n.description.uri,delegate:t,ctx:r},null)}},getBuffer:{value:function(e,t,r){return this._getResource(e.id),this._handleWrappedBufferViewResourceLoading(e,t,r),null}},getFile:{value:function(e,t,r){return e.delegate=t,e.ctx=r,this._handleRequest({id:e.id,uri:e.uri,range:[0],type:"text",delegate:t,ctx:r},null),null}}})},33737:(e,t,r)=>{"use strict";r.d(t,{m:()=>n,r:()=>s});var a=r(11085);let n=(i=[],{add:function(e){i.push(e)},remove:function(e){var t=i.indexOf(e);-1!==t&&i.splice(t,1)},removeAll:function(e){i=[]},bindShaderParameters:function(e){for(var t=0;t<i.length;t++)i[t].bindParameters(e)},update:function(e,t){for(var r=0;r<i.length;r++)i[r].update(e,t)}});var i;let s=function(e,t,r,n){this.material=e,this.parameters=t.technique.parameters,this.uniforms=t.technique.uniforms,this.joints=t.joints,this.object=r,this.semantics={},this.m4=new a.Matrix4};s.prototype.bindParameters=function(e){function t(e,t){e.glTFID==n.node&&(t.sourceObject=e)}for(var r in this.uniforms){var a=this.uniforms[r],n=this.parameters[a];if(n.semantic){var i={semantic:n.semantic,uniform:this.material.uniforms[r]};n.node?e.traverse((function(e){t(e,i)})):i.sourceObject=this.object,this.semantics[a]=i}}},s.prototype.update=function(e,t){for(var r in e.updateMatrixWorld(),t.updateMatrixWorld(),t.matrixWorldInverse.copy(t.matrixWorld).invert(),this.semantics){var a=this.semantics[r];if(a)switch(a.semantic){case"MODELVIEW":a.uniform.value.multiplyMatrices(t.matrixWorldInverse,a.sourceObject.matrixWorld);break;case"MODELVIEWINVERSETRANSPOSE":var n=a.uniform.value;this.m4.multiplyMatrices(t.matrixWorldInverse,a.sourceObject.matrixWorld),n.getNormalMatrix(this.m4);break;case"PROJECTION":a.uniform.value.copy(t.projectionMatrix);break;case"JOINTMATRIX":for(var i=a.uniform.value,s=0;s<i.length;s++)i[s].getInverse(a.sourceObject.matrixWorld).multiply(this.joints[s].matrixWorld).multiply(this.object.skeleton.boneInverses[s]);break;default:throw new Error("Unhandled shader semantic"+a)}}}}}]);