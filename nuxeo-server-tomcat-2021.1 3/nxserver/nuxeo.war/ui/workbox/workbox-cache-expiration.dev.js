this.workbox=this.workbox||{},this.workbox.expiration=function(e,r,a,t,n,o,s){"use strict";try{self.workbox.v["workbox:cache-expiration:3.6.3"]=1}catch(e){}const i="timestamp";class c{constructor(e){this._cacheName=e,this._storeName=e,this._db=new r.DBWrapper(this._cacheName,2,{onupgradeneeded:e=>this._handleUpgrade(e)})}_handleUpgrade(e){const r=e.target.result;e.oldVersion<2&&r.objectStoreNames.contains("workbox-cache-expiration")&&r.deleteObjectStore("workbox-cache-expiration"),r.createObjectStore(this._storeName,{keyPath:"url"}).createIndex(i,i,{unique:!1})}setTimestamp(e,r){var a=this;return babelHelpers.asyncToGenerator((function*(){yield a._db.put(a._storeName,{url:new URL(e,location).href,[i]:r})}))()}getAllTimestamps(){var e=this;return babelHelpers.asyncToGenerator((function*(){return yield e._db.getAllMatching(e._storeName,{index:i})}))()}getTimestamp(e){var r=this;return babelHelpers.asyncToGenerator((function*(){return(yield r._db.get(r._storeName,e)).timestamp}))()}deleteUrl(e){var r=this;return babelHelpers.asyncToGenerator((function*(){yield r._db.delete(r._storeName,new URL(e,location).href)}))()}delete(){var e=this;return babelHelpers.asyncToGenerator((function*(){yield e._db.deleteDatabase(),e._db=null}))()}}class m{constructor(e,r={}){if(t.assert.isType(e,"string",{moduleName:"workbox-cache-expiration",className:"CacheExpiration",funcName:"constructor",paramName:"cacheName"}),!r.maxEntries&&!r.maxAgeSeconds)throw new a.WorkboxError("max-entries-or-age-required",{moduleName:"workbox-cache-expiration",className:"CacheExpiration",funcName:"constructor"});r.maxEntries&&t.assert.isType(r.maxEntries,"number",{moduleName:"workbox-cache-expiration",className:"CacheExpiration",funcName:"constructor",paramName:"config.maxEntries"}),r.maxAgeSeconds&&t.assert.isType(r.maxAgeSeconds,"number",{moduleName:"workbox-cache-expiration",className:"CacheExpiration",funcName:"constructor",paramName:"config.maxAgeSeconds"}),this._isRunning=!1,this._rerunRequested=!1,this._maxEntries=r.maxEntries,this._maxAgeSeconds=r.maxAgeSeconds,this._cacheName=e,this._timestampModel=new c(e)}expireEntries(){var e=this;return babelHelpers.asyncToGenerator((function*(){if(e._isRunning)return void(e._rerunRequested=!0);e._isRunning=!0;const r=Date.now(),a=yield e._findOldEntries(r),t=yield e._findExtraEntries(),o=[...new Set(a.concat(t))];yield Promise.all([e._deleteFromCache(o),e._deleteFromIDB(o)]),o.length>0?(n.logger.groupCollapsed(`Expired ${o.length} `+(1===o.length?"entry":"entries")+" and removed "+(1===o.length?"it":"them")+" from the "+`'${e._cacheName}' cache.`),n.logger.log(`Expired the following ${1===o.length?"URL":"URLs"}:`),o.forEach((function(e){return n.logger.log(`    ${e}`)})),n.logger.groupEnd()):n.logger.debug("Cache expiration ran and found no entries to remove."),e._isRunning=!1,e._rerunRequested&&(e._rerunRequested=!1,e.expireEntries())}))()}_findOldEntries(e){var r=this;return babelHelpers.asyncToGenerator((function*(){if(t.assert.isType(e,"number",{moduleName:"workbox-cache-expiration",className:"CacheExpiration",funcName:"_findOldEntries",paramName:"expireFromTimestamp"}),!r._maxAgeSeconds)return[];const a=e-1e3*r._maxAgeSeconds,n=yield r._timestampModel.getAllTimestamps(),o=[];return n.forEach((function(e){e.timestamp<a&&o.push(e.url)})),o}))()}_findExtraEntries(){var e=this;return babelHelpers.asyncToGenerator((function*(){const r=[];if(!e._maxEntries)return[];const a=yield e._timestampModel.getAllTimestamps();for(;a.length>e._maxEntries;){const e=a.shift();r.push(e.url)}return r}))()}_deleteFromCache(e){var r=this;return babelHelpers.asyncToGenerator((function*(){const a=yield caches.open(r._cacheName);for(const r of e)yield a.delete(r)}))()}_deleteFromIDB(e){var r=this;return babelHelpers.asyncToGenerator((function*(){for(const a of e)yield r._timestampModel.deleteUrl(a)}))()}updateTimestamp(e){var r=this;return babelHelpers.asyncToGenerator((function*(){t.assert.isType(e,"string",{moduleName:"workbox-cache-expiration",className:"CacheExpiration",funcName:"updateTimestamp",paramName:"url"});const a=new URL(e,location);a.hash="",yield r._timestampModel.setTimestamp(a.href,Date.now())}))()}isURLExpired(e){var r=this;return babelHelpers.asyncToGenerator((function*(){if(!r._maxAgeSeconds)throw new a.WorkboxError("expired-test-without-max-age",{methodName:"isURLExpired",paramName:"maxAgeSeconds"});const t=new URL(e,location);return t.hash="",(yield r._timestampModel.getTimestamp(t.href))<Date.now()-1e3*r._maxAgeSeconds}))()}delete(){var e=this;return babelHelpers.asyncToGenerator((function*(){e._rerunRequested=!1,yield e._timestampModel.delete()}))()}}return e.CacheExpiration=m,e.Plugin=class{constructor(e={}){if(!e.maxEntries&&!e.maxAgeSeconds)throw new a.WorkboxError("max-entries-or-age-required",{moduleName:"workbox-cache-expiration",className:"Plugin",funcName:"constructor"});e.maxEntries&&t.assert.isType(e.maxEntries,"number",{moduleName:"workbox-cache-expiration",className:"Plugin",funcName:"constructor",paramName:"config.maxEntries"}),e.maxAgeSeconds&&t.assert.isType(e.maxAgeSeconds,"number",{moduleName:"workbox-cache-expiration",className:"Plugin",funcName:"constructor",paramName:"config.maxAgeSeconds"}),this._config=e,this._maxAgeSeconds=e.maxAgeSeconds,this._cacheExpirations=new Map,e.purgeOnQuotaError&&s.registerQuotaErrorCallback((()=>this.deleteCacheAndMetadata()))}_getCacheExpiration(e){if(e===o.cacheNames.getRuntimeName())throw new a.WorkboxError("expire-custom-caches-only");let r=this._cacheExpirations.get(e);return r||(r=new m(e,this._config),this._cacheExpirations.set(e,r)),r}cachedResponseWillBeUsed({cacheName:e,cachedResponse:r}){if(!r)return null;let a=this._isResponseDateFresh(r);return this._getCacheExpiration(e).expireEntries(),a?r:null}_isResponseDateFresh(e){if(!this._maxAgeSeconds)return!0;const r=this._getDateHeaderTimestamp(e);return null===r||r>=Date.now()-1e3*this._maxAgeSeconds}_getDateHeaderTimestamp(e){if(!e.headers.has("date"))return null;const r=e.headers.get("date"),a=new Date(r).getTime();return isNaN(a)?null:a}cacheDidUpdate({cacheName:e,request:r}){var a=this;return babelHelpers.asyncToGenerator((function*(){t.assert.isType(e,"string",{moduleName:"workbox-cache-expiration",className:"Plugin",funcName:"cacheDidUpdate",paramName:"cacheName"}),t.assert.isInstance(r,Request,{moduleName:"workbox-cache-expiration",className:"Plugin",funcName:"cacheDidUpdate",paramName:"request"});const n=a._getCacheExpiration(e);yield n.updateTimestamp(r.url),yield n.expireEntries()}))()}deleteCacheAndMetadata(){var e=this;return babelHelpers.asyncToGenerator((function*(){for(const[r,a]of e._cacheExpirations)yield caches.delete(r),yield a.delete();e._cacheExpirations=new Map}))()}},e}({},workbox.core._private,workbox.core._private,workbox.core._private,workbox.core._private,workbox.core._private,workbox.core);