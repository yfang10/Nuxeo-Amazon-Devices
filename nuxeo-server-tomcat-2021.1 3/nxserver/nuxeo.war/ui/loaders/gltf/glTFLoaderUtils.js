let GLTFLoaderUtils=Object.create(Object,{MISSING_DESCRIPTION:{value:"MISSING_DESCRIPTION"},INVALID_PATH:{value:"INVALID_PATH"},INVALID_TYPE:{value:"INVALID_TYPE"},XMLHTTPREQUEST_STATUS_ERROR:{value:"XMLHTTPREQUEST_STATUS_ERROR"},NOT_FOUND:{value:"NOT_FOUND"},ARRAY_BUFFER:{value:"ArrayBuffer"},_streams:{value:{},writable:!0},_streamsStatus:{value:{},writable:!0},_resources:{value:{},writable:!0},_resourcesStatus:{value:{},writable:!0},init:{value:function(){this._streams={},this._streamsStatus={},this._resources={},this._resourcesStatus={}}},_containsResource:{enumerable:!1,value:function(e){return!!this._resources[e]}},_storeResource:{enumerable:!1,value:function(e,t){e?(this._containsResource[e]&&console.log("WARNING: resource:"+e+" is already stored, overriding"),this._resources[e]=t):console.log("ERROR: entry does not contain id, cannot store")}},_getResource:{enumerable:!1,value:function(e){return this._resources[e]}},_loadStream:{value:function(e,t,r){function a(e,t){var r=decodeURIComponent(t);return e?atob(r):r}function s(e,t){for(var r=a(e,t),s=new ArrayBuffer(r.length),n=new Uint8Array(s),u=0;u<r.length;u++)n[u]=r.charCodeAt(u);return s}var n=/^data:(.*?)(;base64)?,(.*)$/.exec(e);if(null===n)if(t)if(e){var u=new XMLHttpRequest;u.open("GET",e,!0),u.responseType=t===this.ARRAY_BUFFER?"arraybuffer":"text",u.setRequestHeader("If-Modified-Since","Sat, 01 Jan 1970 00:00:00 GMT"),u.onload=function(t){200==u.status||206==u.status?r.streamAvailable(e,u.response):r.handleError(GLTFLoaderUtils.XMLHTTPREQUEST_STATUS_ERROR,this.status)},u.send(null)}else r.handleError(GLTFLoaderUtils.INVALID_PATH);else r.handleError(GLTFLoaderUtils.INVALID_TYPE,null);else r.streamAvailable(e,function(e,t){t=void 0!==t?t:"";var r=e[1],n=!!e[2],u=e[3];switch(t){case"":case"text":return a(n,u);case"ArrayBuffer":return s(n,u);case"blob":var i=s(n,u);return new Blob([i],{type:r});case"document":return(new DOMParser).parseFromString(a(n,u),r);case"json":return JSON.parse(a(n,u));default:throw"Unhandled responseType: "+t}}(n,t))}},send:{value:0,writable:!0},requested:{value:0,writable:!0},_handleRequest:{value:function(e){this._resourcesStatus[e.id]?this._resourcesStatus[e.id]++:this._resourcesStatus[e.id]=1;var t=this._streamsStatus[e.uri];if(t&&"loading"===t.status)t.requests.push(e);else{this._streamsStatus[e.uri]={status:"loading",requests:[e]};var r=this,a={streamAvailable:function(e,t){r._streamsStatus[e].requests.forEach((function(e){var a=t.slice(e.range[0],e.range[1]),s=e.delegate.convert(a,e.ctx);r._storeResource(e.id,s),e.delegate.resourceAvailable(s,e.ctx),--r._resourcesStatus[e.id]}),this),delete r._streamsStatus[e]},handleError:function(t,r){e.delegate.handleError(t,r)}};this._loadStream(e.uri,e.type,a)}}},_elementSizeForGLType:{value:function(e,t){var r=0;switch(t){case"SCALAR":r=1;break;case"VEC2":r=2;break;case"VEC3":r=3;break;case"VEC4":case"MAT2":r=4;break;case"MAT3":r=9;break;case"MAT4":r=16}switch(e){case WebGLRenderingContext.FLOAT:return Float32Array.BYTES_PER_ELEMENT*r;case WebGLRenderingContext.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT*r;case WebGLRenderingContext.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT*r;default:return null}}},_handleWrappedBufferViewResourceLoading:{value:function(e,t,r){var a=e.bufferView,s=a.buffer,n=e.byteOffset+a.description.byteOffset,u=[n,this._elementSizeForGLType(e.componentType,e.type)*e.count+n];this._handleRequest({id:e.id,range:u,type:s.description.type,uri:s.description.uri,delegate:t,ctx:r},null)}},getBuffer:{value:function(e,t,r){return this._getResource(e.id),this._handleWrappedBufferViewResourceLoading(e,t,r),null}},getFile:{value:function(e,t,r){return e.delegate=t,e.ctx=r,this._handleRequest({id:e.id,uri:e.uri,range:[0],type:"text",delegate:t,ctx:r},null),null}}});export{GLTFLoaderUtils};